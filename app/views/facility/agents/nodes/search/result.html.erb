<%= javascript_include_tag "/assets/js/jquery.colorbox.js" %>
<%= stylesheet_link_tag "/assets/css/colorbox/colorbox.css" %>

<%= coffee do %>
$(window).on "load", ->
  # setup search modal window
  $(".ajax-box").on "click", ->
    $.colorbox({ html: "<%=j render(partial: "modal", locals: { search_path: "./result.html" }) %>"})
    return false
<% end %>

<%= render file: "facility/agents/addons/search_result/view/upper" %>

<% locations = @items.map(&:locations).flatten.uniq.sort_by{ |item| item.order } %>

<div class="facility-nodes">
  <% if locations.present? %>

      <% locations.each do |loc| %>
          <% items = @items.in(location_ids: loc.id).order_by(address: -1) %>
          <% if items.present? %>
              <header>
                <h2 class="name" id="tokushima"><%= loc.name %></h2>
              </header>
              <table id="<%= loc.basename %>" class="spot-lists">
                <thead>
                <tr>
                  <th><%= Facility::Node::Page.t :name %></th>
                  <th><%= Facility::Node::Page.t :address %></th>
                  <th><%= Facility::Node::Page.t :ssid %></th>
                </tr>
                </thead>
                <tbody>
                <% items.each do |item| %>
                    <tr>
                      <td><%= link_to item.name, item.url %></td>
                      <td><%= item.address %></td>
                      <td><%= item.try(:ssid) %></td>
                    </tr>
                <% end %>
                </tbody>
              </table>
          <% end %>
      <% end %>

  <% else %>

      <table>
        <caption><%= @cur_node.name %></caption>
        <thead>
        <tr>
          <th><%= Facility::Node::Page.t :name %></th>
          <th><%= Facility::Node::Page.t :address %></th>
          <th><%= Facility::Node::Page.t :ssid %></th>
        </tr>
        </thead>
        <tbody>
        <% @items.each do |item| %>
            <tr>
              <td><%= link_to item.name, item.url %></td>
              <td><%= item.address %></td>
              <td><%= item.try(:ssid) %></td>
            </tr>
        <% end %>
        </tbody>
      </table>

  <% end %>
</div>

<%= paginate @items if @items.try(:current_page) %>

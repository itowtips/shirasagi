<div class="job_db-incident job_db-incident-thread">
  <article class="topic">
    <header>
      <h2>
        <span class="name"><%= @item.name %></span>
        <span class="categories">
          <% @item.categories.each do |category| %>
            <%= link_to category.trailing_name, job_db_incident_topics_path(category: category.id), class: "job_db-category-label", style: category_label_css(category) %>
          <% end %>
        </span>
      </h2>
      <nav class="meta">
        <span class="user">木村拓哉</span>
        <span class="datetime"><%= tryb { @item.updated.strftime("%Y/%m/%d %H:%M") } %></span>
      </nav>
    </header>

    <div class="body markdown-body">
      <%= @item.html %>
    </div>

    <% if @item.files.present? %>
      <div class="files">
        <% @item.files.each do |file| %>
          <img src="/assets/img/gws/ic-file.png" alt="" />
          <%= link_to file.humanized_name, file.url, class: "icon-#{file.extname}", target: '_blank' %>
        <% end %>
      </div>
    <% end %>

    <% if @model.allowed?(:edit, @cur_user) %>
      <div class="menu">
        <%= link_to(t('gws/board.links.comment'), new_job_db_incident_topic_comment_path(topic_id: @item.id), class: "btn primary") %>
      </div>
    <% end %>
  </article>

  <% if @item.children.present? %>
    <div class="comments">
      <%= render partial: 'comment', collection: @item.descendants, locals: { parent: @item, recursion: false } %>
    </div>
  <% end %>
</div>

<%
  key = "translate-tool-#{@cur_part.id}"
  options = @cur_part.translate_target_options(@translate_target)
  selected = @translate_target.try(:code)
%>
<%
  # source lang select
  cls = ["translate", key] + @source_lang.accept_languages
  body = select_tag("lang", options_for_select(options, selected), class: cls.join(" "), "aria-label": t("translate.labels.translate_tool"))
  body.sub!('class="translate', 'class="notranslate')
%>
<%== body %>
<% if @en_lang %>
<%
  # en lang select
  cls = ["translate", key] + @en_lang.accept_languages
  body = select_tag("lang", options_for_select(options, selected), class: cls.join(" "), "aria-label": t("translate.labels.translate_tool"), style: "display: none;")
  convertor = Translate::Convertor.new(@cur_site, @cur_site.translate_source, @en_lang)
  body = convertor.convert(body)
  body.sub!('class="translate', 'class="notranslate')
%>
<%== body %>
<% end %>

<%= jquery do %>
SS_Translate.siteUrl = "<%= @cur_site.url %>";
SS_Translate.translateUrl = "<%= @cur_site.translate_url %>";
$(".<%= key %>").on("change", function () {
  var target = $(this).val();
  if (target) {
    url = SS_Kana.url(location.pathname, false);
    url = SS_Translate.url(url, false);
    url = SS_Translate.url(url, target);
    location.href = url;
  } else {
    url = SS_Kana.url(location.pathname, false);
    url = SS_Translate.url(location.pathname, false);
    location.href = url;
  }
});

if ($(".<%= key %>.en").length) {
  var lang = SS_Translate.language();
  var source = <%== @source_lang.accept_languages.to_json %>;
  if (!source.includes(lang)) {
    $(".<%= key %>" + "." + source[0]).hide();
    $(".<%= key %>.en").show();
  }
}
<% end %>

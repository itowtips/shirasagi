<%
  return "" if !@cur_site.translate_enabled?

  id = "translate-tool-#{@cur_part.id}"
  lang_codes = @cur_site.lang_codes

  if @translate_target
    options = [ [ I18n.t("translate.views.show_original"), "" ] ]
  else
    options = [ [I18n.t("translate.views.select_lang"), ""] ]
  end
  options += @cur_site.translate_targets.map do |target|
    label = lang_codes[target] ? lang_codes[target] : target
    [label, target]
  end

  body = select_tag("lang", options_for_select(options, @translate_target), class: "translate", id: id)
  if @preferred_lang.present? && @cur_site.translate_source != @preferred_lang
    convertor = Translate::Convertor.new(@cur_site, @cur_site.translate_source, @preferred_lang)
    body = convertor.convert(body)
  end
  body.sub!('class="translate"', 'class="notranslate"')
%>

<%= jquery do %>
$("#<%= id %>").on("change", function () {
  var target = $(this).val();
  if (target) {
    url = SS_Translate.url(location.pathname, false)
    url = SS_Translate.url(url, target)
    location.href = url;
  } else {
    url = SS_Translate.url(location.pathname, false)
    location.href = url;
  }
});
<% end %>
<%== body %>

(function(){$(function(){var e,t,n;return Opendata.render(),n=location.pathname+"/",$("#navi .main-menu a, #navi .sub-menu a").each(function(){var e;if(e=$(this),0===n.indexOf(e.attr("href")))return e.addClass("current")}),800<=$(window).width()&&(t=$(".pulldown-menu"),e=t.find("a"),t.each(function(){return e.not(".current").hide(),e.filter(".current").prependTo(t).click(function(){return e.not(".current").slideToggle("fast"),!1})})),Opendata_Tooltips.render(),Opendata_SearchUI.render(),Opendata_ListUI.render("table.od-modal"),Opendata_HieraricalCheckbox.render()}),this.Opendata=function(){function i(){}return i.loading='<img style="vertical-align:middle" src="/assets/img/loading.gif" alt="loading.." border="0" widtth="16" height="11" />',i.render=function(e){var t;return null==e&&(e=null),e&&(t=function(){return $("#cboxLoadedContent a").each(function(){var e;if((e=$(this)).addClass("cboxElement"),!e.attr("target")&&!e.data("target"))return e.colorbox({fixed:!0,width:"90%",height:"90%",onComplete:t})})},$(e).find("a").each(function(){var e;if(!(e=$(this)).attr("target")&&!e.data("target"))return e.colorbox({fixed:!0,width:"90%",height:"90%",onComplete:t})})),(e=$(document)).find("a[href^=http]").each(function(){return $(this).addClass("external")}),e.find(".ajax-box").each(function(){var e;return!!(e=$(this)).hasClass("cboxElement")||(e.attr("target")||e.data("target")?void 0:e.colorbox({fixed:!0,width:"90%",height:"90%"}))})},i.ajaxForm=function(e,t){var n;return null==t&&(t={}),e=$(e),n={url:e.attr("action")+".json",dataType:"json",success:function(){},error:function(e){return alert(["== Error =="].concat(e.responseJSON).join("\n"))}},e.on("submit",function(e){return $(this).ajaxSubmit($.extend(n,t)),e.preventDefault()})},i.ajax=function(e,r){return null==r&&(r={}),$(e).click(function(e){var t,n;return t={url:(n=$(this)).attr("href"),beforeSend:function(){return n.html(i.loading)},success:function(){return console.log("success")},error:function(){return alert("== Error ==")}},$.ajax($.extend(t,r)),e.preventDefault(),!1})},i.ajaxDelete=function(e,r){return null==r&&(r={}),$(e).click(function(e){var t,n;return confirm("\u524a\u9664\u3057\u3066\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f")&&(t={type:"DELETE",data:"_method=delete",url:(n=$(this)).attr("href")+".json",dataType:"json",beforeSend:function(){return n.html(i.loading)},success:function(){if(n.data("remove"))return $(n.data("remove")).remove()},error:function(e){return alert(["== Error =="].concat(e.responseJSON).join("\n"))}},$.ajax($.extend(t,r)),e.preventDefault()),!1})},i.confirmUnloading=function(){return $("input[type=text],textarea,select").change(function(){return $(window).on("beforeunload",function(){return"\u5165\u529b\u3057\u305f\u30c7\u30fc\u30bf\u306f\u4fdd\u5b58\u3055\u308c\u307e\u305b\u3093\u3002"})}),$("input[type=submit]").click(function(){return $(window).off("beforeunload")})},i}(),this.Opendata_Tooltips=function(){function e(){}return e.render=function(){var t;return(t=$(".tooltip")).click(function(){var e,t,n,r;return $(".tooltip ul").hide(),n=(t=$(this)).find("ul").outerHeight(),t.offset().top-n<0?(t.find("ul").css("bottom",-1*n-15+"px"),e="ul:after {border: 8px solid transparent; border-bottom-color:#fff; bottom:"+(n-5)+"px;}"):(t.find("ul").css("bottom","18px"),e="ul:after {border: 8px solid transparent; border-top-color:#fff; bottom:-13px;}"),r=$("<style>").append(document.createTextNode(e)),$(".tooltip ul style").remove(),t.find("ul").append(r),t.find("ul").show()}),$(document).click(function(e){if(!t.is($(e.target).closest("div")))return $(".tooltip ul").hide()})},e}(),this.Opendata_ListUI=function(){function o(){}return o.render=function(){return $("table.od-modal tbody tr").each(function(){var t,i;return i=$(this),t=i.parent(),i.find(".tap-menu a").each(function(){if("/delete"===$(this).attr("href").slice(-7))return i.find(".tap-menu").after("<nav class='multiple-menu'><a href='multipleDelete' >\u3059\u3079\u3066\u524a\u9664\u3059\u308b</a></nav>")}),i.find("input[type=checkbox]").each(function(){return i.toggleClass("checked",$(this).prop("checked"))}),i.find("input[type=checkbox]").change(function(){var e,t,n,r;for(i.toggleClass("checked",$(this).prop("checked")),t=e=0,n=(r=$("input[name='ids[]']")).length;t<n;t++)r[t].checked&&e++;if($("thead input[type=checkbox]").prop("checked",0<e&&$("input[name='ids[]']").length===e),!this.checked)return i.find(".multiple-menu").hide()}),i.find("input[type=checkbox]").mouseover(function(e){if(this.checked)return i.find(".multiple-menu").css("left",e.pageX+15).css("top",e.pageY-5).show()}),i.mouseup(function(e){if(!$(e.target).is("a")&&!$(e.target).is("input"))return t.find("input[type=checkbox]").attr("checked",!1),t.find("tr").removeClass("checked"),i.find(".tap-menu").css("left",e.pageX+2).css("top",e.pageY).show(),i.find("input[type=checkbox]").trigger("click")}),i.mouseleave(function(){return i.find(".tap-menu").hide(),i.find(".multiple-menu").hide()}),i.find(".multiple-menu a").on("click",function(e){var t,n,r,i;if("multipleDelete"===$(this).attr("href")){for(e.preventDefault(),n=0,r=(i=$("input[name='ids[]']")).length;n<r;n++)if((t=i[n]).checked){if(200!==o.deleteitem(t.value).status)return;t.checked=!1}return location.reload()}})}),$("thead input[type=checkbox]").change(function(){var e,t,n,r,i;for(i=[],t=0,n=(r=$("input[name='ids[]']")).length;t<n;t++)e=r[t],i.push(e.checked=this.checked);return i})},o.deleteitem=function(e){return $.ajax({type:"post",url:location.pathname+"/"+e,async:!1,data:"_method=delete",success:function(){},error:function(e){return alert(["== Error =="].concat(e.statusText).join("\n"))}})},o}(),this.Opendata_SearchUI=function(){function i(){}return i.select=function(e){var t,n,r;r=$("<tr>").attr("data-id",e.id),n=(n=$.colorbox.element().closest("dl").find(".hidden-ids").clone(!1)).val(e.id).removeClass("hidden-ids"),t=$('<a class="deselect" href="#">\u524a\u9664</a>').on("click",i.deselect),r.append($("<td>").append($(n)).append(e.name)),r.append($("<td>").append($(t))),$.colorbox.element().closest("dl").find(".ajax-selected tbody").prepend(r)},i.deselect=function(e){return $(this).parents("tr:first").remove(),e.preventDefault()},i.toggleSelectButton=function(){return 0<$("#ajax-box .items input:checkbox").filter(":checked").size()?$("#ajax-box .select-items").parent("div").show():$("#ajax-box .select-items").parent("div").hide()},i.render=function(){return $(".ajax-selected").each(function(){if($(this).find(".deselect").on("click",i.deselect),0===$(this).find(".deselect").size())return $(this).hide()})},i.modal=function(){return $("#ajax-box form.search").on("submit",function(e){return $(this).ajaxSubmit({url:$(this).attr("action"),success:function(e){return $("#cboxLoadedContent").html(e)},error:function(){return alert("== Error ==")}}),e.preventDefault()}),$.colorbox.element().closest("dl").find(".ajax-selected tr[data-id]").each(function(){var e;return e=$(this).attr("data-id"),$("#ajax-box .items [data-id="+e+"]").remove()}),Opendata_ListUI.render("table.od-modal"),$("#ajax-box a.select-item").on("click",function(e){var t,n;return t=$(this).closest("[data-id]").attr("data-id"),n=$(this).text(),i.select({id:t,name:n}),$.colorbox.element().closest("dl").find(".ajax-selected").show(),e.preventDefault(),$.colorbox.close()}),$("#ajax-box .select-items").on("click",function(e){return $("#ajax-box .items input:checkbox").filter(":checked").each(function(){var e,t;return e=$(this).closest("[data-id]").attr("data-id"),""===(t=$(this).closest("[data-id]").find(".select-item").text())&&(t=$(this).closest("[data-id]").text()),i.select({id:e,name:t})}),$.colorbox.element().closest("dl").find(".ajax-selected").show(),e.preventDefault(),$.colorbox.close()}),$("#ajax-box .od-modal").on("change",function(){return i.toggleSelectButton()}),i.toggleSelectButton()},i}(),this.Opendata_HieraricalCheckbox=function(){function e(){}return e.render=function(){return $("label.parent input[type='checkbox']").on("change",function(){var e;return e=$(this).is(":checked"),$(this).closest("div.parent").find("input[type='checkbox']").prop("checked",e)})},e}()}).call(this);
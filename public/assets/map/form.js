(function(){this.Map_Form=function(){function a(){}return a.maxPointForm=10,a.deleteMessage="\u30de\u30fc\u30ab\u30fc\u3092\u524a\u9664\u3057\u3066\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",a.dataID=0,a.clickIcon="http://maps.google.com/mapfiles/ms/icons/blue-dot.png",a.clickMarker=null,a.setMapLoc=function(a,e,t){e=Math.ceil(e*Math.pow(10,6))/Math.pow(10,6),t=Math.ceil(t*Math.pow(10,6))/Math.pow(10,6),a.val(e.toFixed(6)+","+t.toFixed(6))},a.getMapLoc=function(a){var e;return e=a.val().split(","),new google.maps.LatLng(parseFloat(e[0]),parseFloat(e[1]))},a.attachMessage=function(a){google.maps.event.addListener(Map.markers[a],"click",function(){Map.openedInfo&&Map.openedInfo.close(),$('dd[data-id = "'+a+'"]').each(function(){var e,t,r;return t=$(this).find(".marker-name").val(),r=$(this).find(".marker-text").val(),(""!==t||""!==r)&&(e='<div class="marker-info">',""!==t&&(e+="<p>"+t+"</p>"),""!==r&&$.each(r.split(/[\r\n]+/),function(){return e+=this.match(/^https?:\/\//)?'<p><a href="'+this+'">'+this+"</a></p>":"<p>"+this+"</p>"}),Map.openedInfo=new google.maps.InfoWindow({content:e,maxWidth:260}),Map.openedInfo.open(Map.markers[a].getMap(),Map.markers[a])),!1})})},a.geocoderSearch=function(a){var e;return e=new google.maps.Geocoder,e.geocode({address:a,region:"jp"},function(a,e){var t;e===google.maps.GeocoderStatus.OK?(t=a[0],Map.map.setCenter(t.geometry.location),t.geometry.viewport&&Map.map.fitBounds(t.geometry.viewport)):alert("\u5ea7\u6a19\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}),!1},a.clonePointForm=function(){var e;$(".mod-map dd.marker").length<a.maxPointForm&&(e=$(".mod-map dd.marker:last").clone(!1).insertAfter($(".mod-map dd.marker:last")),e.attr("data-id",a.dataID),a.dataID+=1,e.find("input,textarea").val(""),e.find(".marker-name").val(""),e.find(".clear-marker").on("click",function(){return a.clearPointForm(e)}),e.find(".set-marker").on("click",function(){return a.createMarker(e)}),e.find(".marker-name").on("keypress",function(a){return 13===a.which?!1:void 0}))},a.clearPointForm=function(e){$(".mod-map dd.marker").length>1?""!==e.find(".marker-loc").val()?confirm(a.deleteMessage)&&(Map.markers[parseInt(e.attr("data-id"))]&&Map.markers[parseInt(e.attr("data-id"))].setMap(null),e.find("input,textarea").val(""),e.remove()):(Map.markers[parseInt(e.attr("data-id"))]&&Map.markers[parseInt(e.attr("data-id"))].setMap(null),e.remove()):""!==e.find(".marker-loc").val()&&confirm(a.deleteMessage)&&(Map.markers[parseInt(e.attr("data-id"))]&&Map.markers[parseInt(e.attr("data-id"))].setMap(null),e.find("input,textarea").val(""))},a.createMarker=function(e){var t;""!==$(".mod-map .clicked").val()&&(e.find(".marker-loc").val($(".mod-map .clicked").val()),t=parseInt(e.attr("data-id")),Map.markers[t]&&Map.markers[t].setMap(null),Map.markers[t]=new google.maps.Marker({position:a.getMapLoc(e.find(".marker-loc")),map:Map.map}),a.attachMessage(t))},a.setMarkers=function(){var e,t;google.maps.event.addListener(Map.map,"click",function(e){return a.setMapLoc($(".mod-map .clicked"),e.latLng.lat(),e.latLng.lng()),null!==a.clickMarker&&a.clickMarker.setMap(null),a.clickMarker=new google.maps.Marker({position:new google.maps.LatLng(e.latLng.lat(),e.latLng.lng()),icon:a.clickIcon,map:Map.map})}),$(".mod-map .add-marker").on("click",function(){return a.clonePointForm(),!1}),$(".mod-map .clear-marker").on("click",function(){return a.clearPointForm($(this).closest("dd.marker")),!1}),$(".mod-map .set-marker").on("click",function(){return a.createMarker($(this).closest("dd.marker")),!1}),$(".mod-map .location-search").on("click",function(){return a.geocoderSearch($(".mod-map .keyword").val()),!1}),$(".mod-map .keyword").on("keypress",function(e){return 13===e.which?(a.geocoderSearch($(this).val()),!1):void 0}),$(".mod-map .marker-name").on("keypress",function(a){return 13===a.which?!1:void 0}),Map.markers=[],e=new google.maps.LatLngBounds,$(".mod-map dd.marker").each(function(){var t;return $(this).attr("data-id",a.dataID),""!==$(this).find(".marker-loc").val()&&(t=a.getMapLoc($(this).find(".marker-loc")),Map.markers[a.dataID]=new google.maps.Marker({position:t,map:Map.map}),a.attachMessage(a.dataID),e.extend(t)),a.dataID+=1}),Map.markers.length>0&&(t=google.maps.event.addListener(Map.map,"bounds_changed",function(){return this.getZoom()>13&&this.initialZoom===!0&&(this.setZoom(13),this.initialZoom=!1),google.maps.event.removeListener(t)}),Map.map.initialZoom=!0,Map.map.fitBounds(e))},a}()}).call(this);
this.Cms_Form=function(){function o(){}return o.options={check:{syntax:!0}},o.addonSelector=".mod-cms-body",o.render=function(){o.options.check.syntax&&Syntax_Checker.render(o,{afterCheck:o.afterSyntaxCheck}),Link_Checker.render(),Mobile_Size_Checker.render(),Form_Alert.addValidation(Form_Alert.clonedName),Form_Alert.addValidation(Form_Alert.closeConfirmation),Form_Alert.addValidation(Form_Alert.snsPostConfirmation),o.options.check.syntax&&Form_Alert.addAsyncValidation(Form_Alert.asyncValidateSyntaxCheck),Form_Alert.addAsyncValidation(Mobile_Size_Checker.asyncValidateHtml),Form_Alert.render(),Form_Preview.render()},o.editorId="item_html",o.getEditorHtml=function(e){return null==e&&(e=null),e||(e=o.editorId),"undefined"!=typeof tinymce?"<div>"+tinymce.get(e).getContent()+"</div>":"undefined"!=typeof CKEDITOR?"<div>"+CKEDITOR.instances[e].getData()+"</div>":""},o.setEditorHtml=function(e,t){return t=t||{},id=t.id,null==id&&(id=null),id||(id=o.editorId),"undefined"!=typeof tinymce?tinymce.get(id).setContent(e):"undefined"!=typeof CKEDITOR?CKEDITOR.instances[id].setData(e):void 0},o.syntaxChecks={},o.addSyntaxCheck=function(e,t){o.syntaxChecks[e]=t},o.activateSyntaxChecks=function(){Syntax_Checker.resetChecks(),$.each(o.syntaxChecks,function(e,t){var o=$("#"+e)[0];o&&$(o).is(":visible")&&Syntax_Checker.addCheck(e,t)})},o.afterSyntaxCheck=function(){$("[data-check-presence]").each(function(){var e=$(this).attr("data-check-presence");if(e&&!$(this).val()){var t=null;t=(t=$(this).closest(".column-value").attr("id"))||$(this).closest(".addon-view").attr("id"),Syntax_Checker.errors.push({id:t,idx:0,code:e,msg:e+"\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",ele:this})}});var e,t,o,n,r=[],i=[];if($("#addon-cms-agents-addons-form-page .column-value-cms-column-headline").each(function(){i.push($(this).attr("id")),r.push($(this).find('[name="item[column_values][][in_wrap][head]"]').val())}),e=[],r.length)for(o=n=0,t=r.length-1;0<=t?n<=t:t<=n;o=0<=t?++n:--n)0===o?/h[12]/i.test(r[o])||e.push(o):/h3/i.test(r[o])?/h[234]/i.test(r[o-1])||e.push(o):/h4/i.test(r[o])&&(/h[34]/i.test(r[o-1])||e.push(o));for(o=0;o<e.length;o++){var a=e[o];Syntax_Checker.errors.push({id:i[a],idx:0,code:r[a],msg:Syntax_Checker.message.invalidOrderOfH,detail:Syntax_Checker.detail.invalidOrderOfH})}},o.form_html_path=null,o.form_link_check_path=null,o.getHtml=function(t,n){if([".mod-cms-body",".mod-body-part-html"].includes(o.addonSelector))t(o.getEditorHtml());else if(o.form_html_path){var e=o.getFormData($("#"+Form_Preview.form_id));e.append("route",Form_Preview.page_route),$.ajax({type:"POST",url:o.form_html_path,data:e,processData:!1,contentType:!1,cache:!1,success:function(e){t("<div>"+e+"</div>")},error:function(e,t,o){n&&n(e,t,o)}})}else n&&n(null,null,"form html path is not configured")},o.getFormData=function(e,t){t||(t={});var o=new FormData;return $.each(e.serializeArray(),function(){(t.preserveMethod||"_method"!==this.name)&&o.append(this.name,this.value)}),o},o}(),this.Form_Alert=function(){function p(){}return(Cms_Form.alert=p).alerts={},p.asyncValidations=[],p.beforeSaves=[],p.render=function(){$("input:submit").on("click.form_alert",function(e){var t=this,o=$(t).closest("form"),n=function(e){p.asyncValidate(o,t,{html:e}).done(function(){SS.isEmptyObject(p.alerts)?($(t).off(".form_alert"),setTimeout(function(){$(t).trigger("click")},0)):p.showAlert(o,t)})},r=function(e,t,o){alert(o)};return Cms_Form.getHtml(n,r),e.preventDefault(),!1})},p.asyncValidate=function(t,o,n){p.alerts={};var r=[];return $.each(p.asyncValidations,function(){var e=this(t,o,n);r.push(e)}),$.when.apply($,r)},p.addValidation=function(e){return p.asyncValidations.push(p.wrapDeferred(e))},p.addAsyncValidation=function(e){return p.asyncValidations.push(e)},p.runBeforeSave=function(e,t){return $.each(p.beforeSaves,function(){return this(e,t)})},p.showAlert=function(e,t){var o=$('<div id="alertExplanation" class="errorExplanation">');o.append("<h2>\u8b66\u544a</h2>");var n=p.alerts,r=$(t).attr("data-alert-msg");for(var i in n){var a=n[i];o.append("<p>"+i+"</p>"),r&&o.append("<p>"+r+"</p>");var s,l,c,d=$("<ul>").appendTo(o);for(s=l=0,c=a.length;l<c;s=++l){var h=a[s];h.msg&&d.append("<li>"+h.msg+"</li>")}}var u=$(document.createElement("footer")).addClass("send");r||u.append('<button name="button" type="button" class="btn-primary save">\u8b66\u544a\u3092\u7121\u8996\u3059\u308b</button>'),u.append('<button name="button" type="button" class="btn-default cancel">\u30ad\u30e3\u30f3\u30bb\u30eb</button>'),$.colorbox({html:o.get(0).outerHTML+u.get(0).outerHTML,maxHeight:"80%",fixed:!0}),$("#cboxLoadedContent").find(".save").on("click",function(){return p.runBeforeSave(e,t),$(t).off(".form_alert"),$(t).trigger("click")}),$("#cboxLoadedContent").find(".cancel").on("click",function(){return $.colorbox.close(),!1})},p.addBeforeSave=function(e){return p.beforeSaves.push(e)},p.asyncValidateSyntaxCheck=function(){var e=Syntax_Checker.asyncCheck();return e.done(function(){$.each(Syntax_Checker.errors,function(e,t){p.add("\u30a2\u30af\u30bb\u30b7\u30d3\u30ea\u30c6\u30a3\u30c1\u30a7\u30c3\u30af",t.ele,t.msg)})}),e},p.presence=function(e){return $(e).find("input.presence,textarea.presence").each(function(){var e,t;if(""===$(this).val())return $(this).closest("dl").show(),e=$(this).closest(".addon-view").find("header").text(),t=p.justText($(this).closest("dd").prev("dt")),p.add(e,this,t+"\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002")})},p.wrapDeferred=function(r){return function(e,t){var o=$.Deferred();try{r(e,t),o.resolve()}catch(n){o.reject(n)}return o.promise(e,t)}},p.clonedName=function(e,t){var o=$(e).find("#addon-basic #item_name");if($(t).hasClass("publish_save")&&/^\[\u8907\u88fd\]/.test($(o).val())){var n=$(o).closest(".addon-view").find("header").text();return p.add(n,o,"\u30bf\u30a4\u30c8\u30eb\u306b[\u8907\u88fd]\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002")}},p.closeConfirmation=function(e,t){var o,n;if($(t).attr("data-close-confirmation"))return o="\u975e\u516c\u958b\u72b6\u614b\u3067\u4fdd\u5b58\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059",n=null,$(t).attr("data-contain-links-path")&&(n='<a href="'+$(t).attr("data-contain-links-path")+'" target="_blank" rel="noopener">\u3053\u306e\u30da\u30fc\u30b8\u3078\u306e\u30ea\u30f3\u30af\u3092\u78ba\u8a8d\u3059\u308b\u3002</a>'),p.add(o,null,n)},p.snsPostConfirmation=function(e,t){var o,n,r;n=[],(r=$(t).data("sns-post-confirmation"))&&(n=r()),o="SNS\u6295\u7a3f\u9023\u643a",$.each(n,function(){p.add(o,null,this)})},p.add=function(e,t,o){var n;return(n=p.alerts)[e]||(n[e]=[]),p.alerts[e].push({ele:t,msg:o})},p.justText=function(e){return $(e).clone().children().remove().end().text()},p.validateReplaceWord=function(e){var t,o,n,r,i,a;if(a=Syntax_Checker.config.replace_words){for(n in t=["#addon-basic","#addon-cms-agents-addons-meta","#addon-event-agents-addons-date","#addon-map-agents-addons-page"],o=['[name="item[basename]"]',"location-search.keyword"],r=[],a)i=a[n],r.push($(e).find(t.join(",")).find("input,textarea").not(o.join(",")).each(function(){var e,t,o;if((o=$(this).val())&&!SS.isEmptyObject(o.match(RegExp(""+n.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1"),"g"))))return $(this).closest("dl").show(),e=$(this).closest(".addon-view").find(".addon-head").text(),t=p.justText($(this).closest("dd").prev("dt")),p.add(e,this,t+"\u306b\u4f7f\u7528\u304c\u597d\u307e\u3057\u304f\u306a\u3044\u5358\u8a9e\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\u300c"+n+"\u300d\u2192\u300c"+i+"\u300d")}));return r}},p}(),this.Form_Preview=function(){function d(){}return d.form_preview_path,d.form_id="item-form",d.page_route,d.render=function(){$("button.preview").not(".form-preview-rendered").on("click",function(){var e,t,o,n,r,i,a,s,l,c;if(i=$("#"+d.form_id+" input[name='item[name]']").val(),e=$("#"+d.form_id+" input[name='item[basename]']").val(),t=[],i||t.push("\u30bf\u30a4\u30c8\u30eb\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),e?/^[\w\-]+(\.html)?$/.test(e)||t.push("\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u4e0d\u6b63\u306a\u5024\u3067\u3059\u3002"):t.push("\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),!SS.isEmptyObject(t))return alert(t.join("\n")),!1;for(r in s=$('meta[name="csrf-token"]').attr("content"),o=$("<form>"),$(o).attr("method","post"),$(o).attr("action",d.form_preview_path),$(o).attr("target","FormPreview"),a=$("#"+d.form_id).serializeArray())l=a[r],/^item\[/.test(l.name)&&"item[html]"!==l.name&&"item[body_parts][]"!==l.name&&o.append($("<input/>",{name:l.name.replace(/^item\[/,"preview_item["),value:l.value,type:"hidden"}));return $("textarea[id^=item_html_part_]").each(function(){var e;return e=$(this).attr("id"),i=$(this).attr("name").replace(/^item\[/,"preview_item["),o.append($("<input/>",{name:i,value:Cms_Form.getEditorHtml(e),type:"hidden"}))}),o.append($("<input/>",{name:"preview_item[route]",value:d.page_route,type:"hidden"})),o.append($("<input/>",{name:"preview_item[html]",value:Cms_Form.getEditorHtml("item_html"),type:"hidden"})),o.append($("<input/>",{name:"authenticity_token",value:s,type:"hidden"})),c=$(window).width(),n=$(window).height(),window.open("about:blank","FormPreview","width="+c+",height="+n+",resizable=yes,scrollbars=yes"),o.appendTo("body"),o.submit(),!1}),$("button.preview").addClass("form-preview-rendered")},d}(),this.Form_Save_Event=function(){function e(){}return e.render=function(){return document.onkeydown=function(){if((event.ctrlKey||event.metaKey)&&83===event.keyCode)return event.keyCode=0,$("#"+Form_Preview.form_id).submit(),!1}},e}(),this.Cms_Inplace_Form=function(){function n(){}return n.addonSelector=".inplace-checkers",n.resolveType="text",n.getFormData=Cms_Form.getFormData,n.options={check:{form:!0,syntax:!0,link:!0}},n.linkChecker=null,n.formChecker=null,n.render=function(){n.options.check.syntax&&Syntax_Checker.render(n,{afterCheck:n.afterSyntaxCheck}),n.options.check.link&&(n.linkChecker=Link_Checker.render(n)),n.options.check.form&&(n.formChecker=Form_Checker.render(n)),n.renderSaveIfNoAlerts()},n.setEditorHtml=function(e,t){t=t||{},n.setContent(e,t)},n.afterSyntaxCheck=function(){$("[data-check-presence]").each(function(){var e=$(this).attr("data-check-presence");if(e&&!$(this).val()){var t=null;t=$(this).closest(".column-value").attr("id"),Syntax_Checker.errors.push({id:t,idx:0,code:e,msg:e+"\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",ele:this})}})},n.renderSaveIfNoAlerts=function(){$('input:submit[name="save_if_no_alerts"]').on("click.form_alert",function(e){var o=$(this),t=[];return n.options.check.syntax&&t.push(Syntax_Checker.asyncCheck()),n.options.check.link&&t.push(n.linkChecker.asyncCheck()),n.options.check.form&&t.push(n.formChecker.asyncCheck()),0===t.length||($.when.apply($,t).then(function(){for(var e=!0,t=0;t<arguments.length;t++)if("ok"!==arguments[t].status){e=!1;break}e&&(o.off(".form_alert"),o.trigger("click"))}),e.preventDefault(),!1)})},n}(),this.Syntax_Checker=function(){function o(e){this.$el=null,this.$elBody=null,this.form=e}function c(){}return o.prototype.init=function(){if(this.$el)return this;var e=$("#errorSyntaxChecker");if(e[0])return this.$el=e,this.$elBody=e.find(".errorExplanationBody"),this.moveLast();(e=$("<div/>",{id:"errorSyntaxChecker","class":"errorExplanation"})).append("<h2>\u30a2\u30af\u30bb\u30b7\u30d3\u30ea\u30c6\u30a3\u30c1\u30a7\u30c3\u30af</h2>");var t=$("<div/>",{"class":"errorExplanationBody"});return e.append(t),this.$el=e,this.$elBody=t,this.moveLast()},o.prototype.moveLast=function(){return $(this.form.addonSelector).append(this.$el),this},o.prototype.showMessage=function(e){return this.init(),this.$elBody.html(e),this.moveLast(),this},o.prototype.showChecking=function(){return this.showMessage(SS.loading)},o.prototype.showResult=function(e,t){if(0!=t.length){this.init();var o=$("<ul/>");return this.appendMessage(o,e,t),this.$elBody.html(""),this.$elBody.append("<p>\u6b21\u306e\u9805\u76ee\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"),this.$elBody.append(o),this.moveLast(),$(window).trigger("resize"),this}this.showMessage("<p>\u30a8\u30e9\u30fc\u306f\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002</p>")},o.prototype.appendMessage=function(n,e,t){var r,l,c,d,o,h=this,i={};$.each(t,function(e,t){var o=t.id;i[o]=i[o]||[],i[o].push(t)}),$.each(e,function(a,s){(t=i[a])&&(s.name&&((o=$('<li class="column-name">')).text(s.name),n.append(o)),$.each(t,function(e,i){if((d=$("<code>")).text(i.code),n.append('<li class="code">'),n.find("li:last").append(d),n.append("<ul>"),n.find("> ul:last").append("<li>"),l=n.find("> ul:last li:last"),c=$('<span class="message detail">'+i.msg+"</span>"),i.detail){var t=$('<div class="tooltip">!</div>').appendTo(c),o=$('<ul class="tooltip-content">').appendTo(t);$.each(i.detail,function(){o.append("<li>"+this+"<br></li>")})}l.append(c),i.correctContent&&((r=$('<a href="#" class="correct">\u81ea\u52d5\u4fee\u6b63</a>')).on("click",function(){var e,t,o,n,r;return o=i.correctContent,e=s.setContent,t=s.getContent,n=s.resolve,r=s.type,e(o(a,{content:t(),resolve:n,type:r},i)),$(h.form.addonSelector).find("button.syntax-check").trigger("click"),!1}),l.append(r))}))})},c.checks={},c.errors=[],c.errorCount=0,c.form=null,c.resultBox=null,c.afterCheck=null,c.render=function(e,t){e=e||Cms_Form,t=t||{},c.form=e,c.options=t,c.resultBox=new o(c.form),c.afterCheck=t.afterCheck,$(document).on("click","button.syntax-check",function(){var e=this;e.disabled=!0;var t=function(){e.disabled=!1};c.resultBox.init(),c.resultBox.showChecking(),c.asyncCheck().done(t).fail(t)})},c.config={},c.asyncCheck=function(){var t=$.Deferred();return function(){try{c.check(),c.resultBox.showResult(c.checks,c.errors),t.resolve({status:0==c.errors.length?"ok":"failed"})}catch(e){c.resultBox.showMessage("<p>"+e+"</p>"),t.reject(null,null,e)}}(),t.promise()},c.addCheck=function(e,t){var o=(t=t||{}).name||null,n=t.resolve||"text",r=t.type||"string",i=t.getContent,a=t.setContent,s=t.afterCheck;c.checks[e]={name:o,resolve:n,type:r,getContent:i,setContent:a,afterCheck:s}},c.resetChecks=function(){c.checks={},c.errors=[],c.errorCount=0},c.getContents=function(){var o={};return $.each(c.checks,function(e,t){o[e]={content:t.getContent(),resolve:t.resolve,type:t.type,afterCheck:t.afterCheck}}),o},c.check=function(){var e,o;return c.reset(),e=c.getContents(),$.each(e,function(e,t){"html"==t.resolve?c.checkHtml(e,t):c.checkText(e,t),(o=t.afterCheck)&&o(e,t)}),c.afterCheck&&c.afterCheck(),c.errors},c.reset=function(){this.errors=[]},c.checkHtml=function(e,t){c.checkDateFormat(e,t),c.checkInterwordSpace(e,t),c.checkKanaCharacter(e,t),c.checkMultibyteCharacter(e,t),c.checkReplaceWords(e,t),c.checkAdjacentA(e,t),c.checkAppletAlt(e,t),c.checkAreaAlt(e,t),c.checkEmbeddedMedia(e,t),c.checkImgAlt(e,t),c.checkImgDataUriScheme(e,t),c.checkLinkText(e,t),c.checkObjectText(e,t),c.checkOrderOfH(e,t),c.checkTable(e,t)},c.checkText=function(e,t){c.checkDateFormat(e,t),c.checkInterwordSpace(e,t),c.checkKanaCharacter(e,t),c.checkMultibyteCharacter(e,t),c.checkReplaceWords(e,t)},c.isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&(!isNaN(e.getTime())&&0<e.getYear())},c.justText=function(e){return $(e).clone().children().remove().end().text()},c.outerHtmlSummary=function(e){return $(e).get(0).outerHTML.replace(/[\r\n]|&nbsp;/g,"")},c.message={notSetImgAlt:"\u753b\u50cf\u306e\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002",notSetAppletAlt:"\u30a2\u30d7\u30ec\u30c3\u30c8\u8981\u7d20\u306e\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002",notSetAreaAlt:"\u30a8\u30ea\u30a2\u8981\u7d20\u306e\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002",invalidImgScheme:"\u753b\u50cf\u306eURI\u306b\u30d0\u30a4\u30ca\u30ea\u30fc\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002",notSetTableCaption:"\u8868\u306b\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",notSetThScope:"\u8868\u306e\u30d8\u30c3\u30c0\u30fc\u306b\u30b9\u30b3\u30fc\u30d7\u5c5e\u6027\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",invalidOrderOfH:"\u898b\u51fa\u3057(H)\u306e\u9806\u756a\u304c\u4e0d\u6b63\u3067\u3059\u3002",invalidMultibyteCharacter:"\u82f1\u6570\u5b57\u306f\u534a\u89d2\u6587\u5b57\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",invalidKanaCharacter:"\u534a\u89d2\u30ab\u30ca\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002",invalidDateFormat:"\u65e5\u4ed8\u306e\u8868\u8a18\u306f\u25cb\u5e74\u25cb\u6708\u25cb\u65e5\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002",invalidAdjacentA:"\u96a3\u63a5\u3059\u308b\u540c\u3058\u30ea\u30f3\u30af\u3092\u4e00\u3064\u306e\u30ea\u30f3\u30af\u306b\u307e\u3068\u3081\u3066\u304f\u3060\u3055\u3044\u3002",checkInterwordSpace:"\u5358\u8a9e\u306e\u6587\u5b57\u9593\u306e\u30b9\u30da\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002",checkLinkText:"\u30ea\u30f3\u30af\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002",checkObjectText:"\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u8981\u7d20\u306e\u30dc\u30c7\u30a3\u306b\u9069\u5207\u306a\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002",checkEmbeddedMedia:"\u52d5\u753b\u3084\u97f3\u58f0\u3092\u542b\u3080\u5834\u5408\u3001\u8aac\u660e\u304c\u3042\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002",replaceWord:"\u4f7f\u7528\u304c\u597d\u307e\u3057\u304f\u306a\u3044\u5358\u8a9e\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002",altIsIncludedInFilename:"\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u304c\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002"},c.detail={notSetImgAlt:["\u753b\u50cf\u306e\u5185\u5bb9\u3092\u793a\u3059\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],notSetAppletAlt:["\u30a2\u30d7\u30ec\u30c3\u30c8\u306e\u5185\u5bb9\u3092\u793a\u3059\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],notSetAreaAlt:["\u30a8\u30ea\u30a2\u8981\u7d20\u306e\u5185\u5bb9\u3092\u793a\u3059\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],invalidImgScheme:["\u753b\u50cf\u306eSRC\u5c5e\u6027\u306b\u30c7\u30fc\u30bf\u5f62\u5f0f\u306eURI\u30b9\u30ad\u30fc\u30e0\u304c\u5b58\u5728\u3057\u307e\u3059\u3002","\u4ed6\u306eURI\u30b9\u30ad\u30fc\u30e0\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],notSetTableCaption:["\u8868\u306b\u898b\u51fa\u3057(CAPTION)\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093","TABLE\u30bf\u30b0\u306e\u4e2d\u306bCAPTION\u30bf\u30b0\u3092\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],notSetThScope:["\u8868\u306e\u30d8\u30c3\u30c0\u30fc(TH)\u306b\u898b\u51fa\u3057\u306e\u65b9\u5411\u3067\u3042\u308bSCOPE\u5c5e\u6027\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",'\u884c\u65b9\u5411\u3067\u3042\u308c\u3070scope="col\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002','\u5217\u65b9\u5411\u3067\u3042\u308c\u3070scope="row"\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002'],invalidOrderOfH:["\u9069\u5207\u306a\u9806\u306b\u914d\u7f6e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],invalidMultibyteCharacter:["\u672c\u6587\u306b\u5168\u89d2\u82f1\u6570\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002","\u534a\u89d2\u82f1\u6570\u306b\u7f6e\u304d\u63db\u3048\u308b\u304b\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],invalidKanaCharacter:["\u672c\u6587\u306b\u534a\u89d2\u30ab\u30ca\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002","\u5168\u89d2\u6587\u5b57\u306b\u7f6e\u304d\u63db\u3048\u308b\u304b\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],invalidDateFormat:["\u65e5\u4ed8\u306e\u5f62\u5f0f\u3092\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],invalidAdjacentA:["\u96a3\u308a\u5408\u3046\u30ea\u30f3\u30af(A)\u306b\u540c\u3058\u30ea\u30f3\u30af\u5148\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002","\u4e00\u3064\u306e\u30ea\u30f3\u30af(A)\u306b\u30de\u30fc\u30af\u30a2\u30c3\u30d7\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],checkInterwordSpace:["\u5358\u8a9e\u306e\u6587\u5b57\u9593\u306b\u4e0d\u8981\u306a\u30b9\u30da\u30fc\u30b9\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],checkLinkText:["\u30ea\u30f3\u30af\u5185\u306e\u30c6\u30ad\u30b9\u30c8\u306f\u9077\u79fb\u5148\u3092\u8868\u3059\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],checkObjectText:["\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u8981\u7d20\u304c\u6b63\u3057\u304f\u8aad\u307f\u8fbc\u307e\u308c\u306a\u304b\u3063\u305f\u5834\u5408\u306e\u8aac\u660e\u3092\u8981\u7d20\u5185\u306b\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],checkEmbeddedMedia:["\u52d5\u753b\u3084\u97f3\u58f0\u3092\u672c\u6587\u306b\u57cb\u3081\u8fbc\u3080\u5834\u5408\u306f\u8aac\u660e\u3092\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002"],altIsIncludedInFilename:["\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306e\u4e00\u90e8\u3082\u3057\u304f\u306f\u5168\u90e8\u304c\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002","\u4e00\u822c\u7684\u306b\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u305d\u306e\u307e\u307e\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306b\u8a2d\u5b9a\u3059\u308b\u306e\u306f\u597d\u307e\u3057\u304f\u306a\u3044\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002","\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u304c\u59a5\u5f53\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]},c.mediaExtensions=["aac","aif","aiff","au","avi","flac","flv","mid","midi","mp3","m4a","mp4","mpg","mpeg","oga","ogg","tta","vdo","wav","wma","wmv"],c.formatContent=function(e){var t=e.content,o=e.resolve,n=e.type,r=[];return"array"==n?$.each(t,function(e,t){t=t||"","html"==o?r.push(t):r.push("<div>"+t+"</div>")}):(t=t||"","html"==o?r.push(t):r.push("<div>"+t+"</div>")),r},c.checkMultibyteCharacter=function(o,e){var t,n;t=c.formatContent(e),$.each(t,function(e,t){n=[],$(t).find(":not(iframe)").addBack().contents().filter(function(){return 3==this.nodeType}).each(function(){var e;if(e=this.textContent.match(/[\uff21-\uff3a\uff41-\uff5a\uff10-\uff19]/g))return n.push(e)}),SS.isEmptyObject(n)||c.errors.push({id:o,idx:e,code:n.join(","),ele:t,msg:c.message.invalidMultibyteCharacter,detail:c.detail.invalidMultibyteCharacter,correctContent:c.correctMultibyteCharacter})})},c.correctMultibyteCharacter=function(e,t){var o,n;return n=[],o=c.formatContent(t),$.each(o,function(e,t){(t=$(t)).find(":not(iframe)").addBack().contents().filter(function(){return 3==this.nodeType}).each(function(){var e;return e=this.textContent.replace(/[\uff21-\uff3a\uff41-\uff5a\uff10-\uff19]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),this.textContent=e}),n.push(t.html())}),"array"==t.type?n:n[0]},c.checkKanaCharacter=function(o,e){var t,n;t=c.formatContent(e),$.each(t,function(e,t){n=t.match(/[\uff61-\uff9f]/g),SS.isEmptyObject(n)||c.errors.push({id:o,idx:e,code:n.join(","),ele:t,msg:c.message.invalidKanaCharacter,detail:c.detail.invalidKanaCharacter,correctContent:c.correctKanaCharacter})})},c.correctKanaCharacter=function(e,t){var o,n,r,i;return n=[],o=c.formatContent(t),r={"\uff61":"\u3002","\uff62":"\u300c","\uff63":"\u300d","\uff64":"\u3001","\uff65":"\u30fb","\uff66":"\u30f2","\uff67":"\u30a1","\uff68":"\u30a3","\uff69":"\u30a5","\uff6a":"\u30a7","\uff6b":"\u30a9","\uff6c":"\u30e3","\uff6d":"\u30e5","\uff6e":"\u30e7","\uff6f":"\u30c3","\uff70":"\u30fc","\uff71":"\u30a2","\uff72":"\u30a4","\uff73":"\u30a6","\uff74":"\u30a8","\uff75":"\u30aa","\uff76":"\u30ab","\uff77":"\u30ad","\uff78":"\u30af","\uff79":"\u30b1","\uff7a":"\u30b3","\uff7b":"\u30b5","\uff7c":"\u30b7","\uff7d":"\u30b9","\uff7e":"\u30bb","\uff7f":"\u30bd","\uff80":"\u30bf","\uff81":"\u30c1","\uff82":"\u30c4","\uff83":"\u30c6","\uff84":"\u30c8","\uff85":"\u30ca","\uff86":"\u30cb","\uff87":"\u30cc","\uff88":"\u30cd","\uff89":"\u30ce","\uff8a":"\u30cf","\uff8b":"\u30d2","\uff8c":"\u30d5","\uff8d":"\u30d8","\uff8e":"\u30db","\uff8f":"\u30de","\uff90":"\u30df","\uff91":"\u30e0","\uff92":"\u30e1","\uff93":"\u30e2","\uff94":"\u30e4","\uff95":"\u30e6","\uff96":"\u30e8","\uff97":"\u30e9","\uff98":"\u30ea","\uff99":"\u30eb","\uff9a":"\u30ec","\uff9b":"\u30ed","\uff9c":"\u30ef","\uff9d":"\u30f3","\uff9e":"\u309b","\uff9f":"\u309c"},i={"\uff76\uff9e":"\u30ac","\uff77\uff9e":"\u30ae","\uff78\uff9e":"\u30b0","\uff79\uff9e":"\u30b2","\uff7a\uff9e":"\u30b4","\uff7b\uff9e":"\u30b6","\uff7c\uff9e":"\u30b8","\uff7d\uff9e":"\u30ba","\uff7e\uff9e":"\u30bc","\uff7f\uff9e":"\u30be","\uff80\uff9e":"\u30c0","\uff81\uff9e":"\u30c2","\uff82\uff9e":"\u30c5","\uff83\uff9e":"\u30c7","\uff84\uff9e":"\u30c9","\uff8a\uff9e":"\u30d0","\uff8b\uff9e":"\u30d3","\uff8c\uff9e":"\u30d6","\uff8d\uff9e":"\u30d9","\uff8e\uff9e":"\u30dc","\uff8a\uff9f":"\u30d1","\uff8b\uff9f":"\u30d4","\uff8c\uff9f":"\u30d7","\uff8d\uff9f":"\u30da","\uff8e\uff9f":"\u30dd","\uff73\uff9e":"\u30f4","\uff9c\uff9e":"\u30f7","\uff66\uff9e":"\u30fa"},$.each(o,function(e,t){(t=$(t)).find(":not(iframe)").addBack().contents().filter(function(){return 3===this.nodeType}).each(function(){var o=this.textContent;$.each(i,function(e,t){o=o.replace(new RegExp(e,"g"),t)}),o=o.replace(/[\uff61-\uff9f]/g,function(e){return r[e]}),this.textContent=o}),n.push(t.html())}),"array"==t.type?n:n[0]},c.checkReplaceWords=function(i,e){var t,a;t=c.formatContent(e),(a=c.config.replace_words)&&$.each(t,function(e,t){var o,n,r;for(n in a)r=a[n],o=t.match(RegExp(""+n.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1"),"g")),SS.isEmptyObject(o)||c.errors.push({id:i,idx:e,code:o[0],ele:t,msg:c.message.replaceWord+"\u300c"+n+"\u300d\u2192\u300c"+r+"\u300d",correctContent:c.correctReplaceWords,replaceKey:n,replaceValue:r})})},c.correctReplaceWords=function(e,t,o){var n,r,i,a,s,l;if(i=c.formatContent(t),n=o.replaceKey,r=o.replaceValue,a=[],s=RegExp(""+n.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1","g")),n||r)return $.each(i,function(e,t){(t=$(t)).find(":not(iframe)").addBack().contents().filter(function(){return 3===this.nodeType}).each(function(){var e;e=this.textContent.replace(s,r),this.textContent=e}),t.find("img[alt]").each(function(){l=$(this).attr("alt").replace(s,r),$(this).attr("alt",l)}),a.push(t.html())}),"array"==t.type?a:a[0]},c.checkDateFormat=function(o,e){var t,n;t=c.formatContent(e),$.each(t,function(e,t){n=[],$(t).find(":not(iframe)").addBack().contents().filter(function(){return 3===this.nodeType}).each(function(){var e;(e=this.textContent.match(/\d{4}[\.\-\/]\d{1,2}[\.\-\/]\d{1,2}/g))&&(n=$.merge(n,e))}),SS.isEmptyObject(n)||(n=$.grep(n,function(e){return c.isValidDate(new Date(e))}),SS.isEmptyObject(n)||c.errors.push({id:o,idx:e,code:n.join(","),ele:t,msg:c.message.invalidDateFormat,detail:c.detail.invalidDateFormat,correctContent:c.correctDateFormat}))})},c.correctDateFormat=function(e,t){var o,n;return n=c.formatContent(t),o=[],$.each(n,function(e,t){(t=$(t)).find(":not(iframe)").addBack().contents().filter(function(){return 3===this.nodeType}).each(function(){var e;return e=this.textContent.replace(/(\d{4})[\.\-\/](\d{1,2})[\.\-\/](\d{1,2})/g,function(e,t,o,n){return c.isValidDate(new Date([t,o,n].join("/")))?t+"\u5e74"+o+"\u6708"+n+"\u65e5":e}),this.textContent=e}),o.push(t.html())}),"array"==t.type?o:o[0]},c.checkImgAlt=function(n,e){var t;t=c.formatContent(e),$.each(t,function(o,e){$(e).find("img").each(function(){var e=this.alt;e&&(e=$.trim(e)),e||c.errors.push({id:n,idx:o,code:c.outerHtmlSummary(this),ele:this,msg:c.message.notSetImgAlt,detail:c.detail.notSetImgAlt});var t=this.src;t&&(t=$.trim(t)),e&&t&&t.toLowerCase().includes(e.toLowerCase())&&c.errors.push({id:n,idx:o,code:c.outerHtmlSummary(this),ele:this,msg:c.message.altIsIncludedInFilename,detail:c.detail.altIsIncludedInFilename})})})},c.checkAppletAlt=function(o,e){var t;t=c.formatContent(e),$.each(t,function(t,e){$(e).find("applet").each(function(){var e;(e=$(this).attr("alt"))&&""!==$.trim(e)&&!/^[\w\s\.\-]*$/.test(e)||c.errors.push({id:o,idx:t,code:c.outerHtmlSummary(this),ele:this,msg:c.message.notSetAppletAlt,detail:c.detail.notSetAppletAlt})})})},c.checkAreaAlt=function(o,e){var t;t=c.formatContent(e),$.each(t,function(t,e){$(e).find("area").each(function(){var e;(e=$(this).attr("alt"))&&""!==$.trim(e)&&!/^[\w\s\.\-]*$/.test(e)||c.errors.push({id:o,idx:t,code:c.outerHtmlSummary(this),ele:this,msg:c.message.notSetAreaAlt,detail:c.detail.notSetAreaAlt})})})},c.checkImgDataUriScheme=function(o,e){var t;t=c.formatContent(e),$.each(t,function(t,e){$(e).find("img[src]").each(function(){var e;e=$(this).attr("src"),/^data:.*?,.*?$/.test(e)&&c.errors.push({id:o,idx:t,code:c.outerHtmlSummary(this),ele:this,msg:c.message.invalidImgScheme,detail:c.detail.invalidImgScheme})})})},c.checkTable=function(n,e){var t;t=c.formatContent(e),$.each(t,function(o,e){$(e).find("table").each(function(){var e,t;t=this,(e=$(this).find("caption"))&&""!==$.trim(e.text())||c.errors.push({id:n,idx:o,code:c.outerHtmlSummary(this),ele:t,msg:c.message.notSetTableCaption,detail:c.detail.notSetTableCaption,correctContent:c.correctTableCaption}),$(t).find("th").each(function(){if(!$(this).attr("scope"))return c.errors.push({id:n,idx:o,code:c.outerHtmlSummary(this),ele:t,msg:c.message.notSetThScope,detail:c.detail.notSetThScope,correctContent:c.correctTableScope}),!1})})})},c.correctTableCaption=function(e,t){var o,n;return n=c.formatContent(t),o=[],$.each(n,function(e,t){t=$(t).find("table"),$(t).find("caption").remove(),$(t).prepend("<caption>\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3</caption>"),t=$(t).parents().last().html()||$(t).html(),o.push(t)}),"array"==t.type?o:o[0]},c.correctTableScope=function(e,t){var o,n,r;return o=c.formatContent(t),n=[],$.each(o,function(e,t){t=$(t).find("table"),r=1==$(t).find("tr:first th").length?"row":"col",$(t).find("tr:first th").each(function(){if(!$(this).attr("scope"))return $(this).attr("scope",r)}),$(t).find("tr:not(:first) th").each(function(){if(!$(this).attr("scope"))return $(this).attr("scope","row")}),t=$(t).parents().last().html()||$(t).html(),n.push(t)}),"array"==t.type?n:n[0]},c.checkOrderOfH=function(o,e){var t,n,r,i,a,s;t=c.formatContent(e),$.each(t,function(e,t){if(t=$(t),!(r=$(t).find("h1,h2,h3,h4,h5,h6")).length)return!1;for(n="",i=a=0,s=r.length-1;0<=s?a<=s:s<=a;i=0<=s?++a:--a)0===i?/h[12]/i.test(r[i].tagName)||(n+=r[i].tagName+" "):/h3/i.test(r[i].tagName)?/h[23456]/i.test(r[i-1].tagName)||(n+=r[i].tagName+" "):/h4/i.test(r[i].tagName)?/h[3456]/i.test(r[i-1].tagName)||(n+=r[i].tagName+" "):/h5/i.test(r[i].tagName)?/h[456]/i.test(r[i-1].tagName)||(n+=r[i].tagName+" "):/h6/i.test(r[i].tagName)&&(/h[56]/i.test(r[i-1].tagName)||(n+=r[i].tagName+" "));""!==n&&c.errors.push({id:o,idx:e,code:n,ele:t,msg:c.message.invalidOrderOfH,detail:c.detail.invalidOrderOfH,correctContent:c.correctOrderOfH})})},c.correctOrderOfH=function(e,t){var o,n,r,i,a,s,l;return o=c.formatContent(t),n=[],$.each(o,function(e,t){if(t=$(t),(r=$(t).find("h1,h2,h3,h4,h5,h6")).length){for(l=t,i=a=0,s=r.length-1;0<=s?a<=s:s<=a;i=0<=s?++a:--a)0===i?/h[12]/i.test(r[i].tagName)||(l=$("<h1>"+$(r[i]).html()+"</h1>"),$(r[i]).after(l).remove(),r[i]=l[0]):/h3/i.test(r[i].tagName)?/h[23456]/i.test(r[i-1].tagName)||((l=$("<"+r[i-1].tagName.replace("1","2")+">")).html($(r[i]).html()),$(r[i]).after(l).remove(),r[i]=l[0]):/h4/i.test(r[i].tagName)?/h[3456]/i.test(r[i-1].tagName)||((l=$("<"+r[i-1].tagName.replace("1","2")+">")).html($(r[i]).html()),$(r[i]).after(l).remove(),r[i]=l[0]):/h5/i.test(r[i].tagName)?/h[456]/i.test(r[i-1].tagName)||((l=$("<"+r[i-1].tagName.replace("1","2")+">")).html($(r[i]).html()),$(r[i]).after(l).remove(),r[i]=l[0]):/h6/i.test(r[i].tagName)&&(/h[56]/i.test(r[i-1].tagName)||((l=$("<"+r[i-1].tagName.replace("1","2")+">")).html($(r[i]).html()),$(r[i]).after(l).remove(),r[i]=l[0]));l=$(l).parents().last().html()||$(l).html(),n.push(l)}else n.push($(t).parents().last().html())}),"array"==t.type?n:n[0]},c.checkAdjacentA=function(n,e){var t;t=c.formatContent(e),$.each(t,function(o,e){e=$(e),$(e).find("a[href]").each(function(){var e,t;t=$(this).attr("href"),(e=$(this).next("a[href]")).length&&t==e.attr("href")&&c.errors.push({id:n,idx:o,code:c.outerHtmlSummary(this)+c.outerHtmlSummary(e),ele:this,msg:c.message.invalidAdjacentA,detail:c.detail.invalidAdjacentA,
correctContent:c.correctAdjacentA})})})},c.correctAdjacentA=function(e,t){var o,n,r,i;return o=c.formatContent(t),n=[],$.each(o,function(e,t){t=$(t),i=$(t).attr("href"),(r=$(t).next("a[href]")).length&&i==r.attr("href")&&($(t).html()!==$(r).html()&&$(t).html($(t).html()+$(r).html()),r.remove()),t=$(t).parents().last().html()||$(t).html(),n.push(t)}),"array"==t.type?n:n[0]},c.checkInterwordSpace=function(i,e){var t;t=c.formatContent(e),$.each(t,function(r,e){e=$(e),$(e).find(":not(iframe)").addBack().contents().filter(function(){return 3==this.nodeType}).each(function(){var e,t,o,n;if(n=$.trim(c.justText(this)),/[\u3000]/.test(n))for(e=t=0,o=n.length-1;0<=o?t<=o:o<=t;e=0<=o?++t:--t)if(256<=n.charCodeAt(e)){c.errors.push({id:i,idx:r,code:n,msg:c.message.checkInterwordSpace,detail:c.detail.checkInterwordSpace});break}})})},c.checkLinkText=function(o,e){var t;t=c.formatContent(e),$.each(t,function(e,t){t=$(t),$(t).find("a[href]").each(function(){$(this).text().length<=3&&c.errors.push({id:o,idx:e,code:c.outerHtmlSummary(this),msg:c.message.checkLinkText,detail:c.detail.checkLinkText})})})},c.checkObjectText=function(o,e){var t;t=c.formatContent(e),$.each(t,function(t,e){e=$(e),$(e).find("object").each(function(){var e;e=$(this).text(),$.trim(e)||c.errors.push({id:o,idx:t,code:c.outerHtmlSummary(this),msg:c.message.checkObjectText,detail:c.detail.checkObjectText})})})},c.checkEmbeddedMedia=function(n,e){var t,r,i;t=c.formatContent(e),$.each(t,function(o,e){e=$(e),$(e).find("embed,video").each(function(){c.errors.push({id:n,idx:o,code:c.outerHtmlSummary(this),msg:c.message.checkEmbeddedMedia,detail:c.detail.checkEmbeddedMedia})}),r=new RegExp("("+c.mediaExtensions.join("|")+")","i"),i=/https?:\/\/www\.youtube\.com\//,$(e).find("iframe[src]").each(function(){var e,t;e=(t=$(this).attr("src")).replace(/\?.*$/,"").replace(/.*\//,"").split(".").pop(),(r.test(e)||i.test(t))&&c.errors.push({id:n,idx:o,code:c.outerHtmlSummary(this),msg:c.message.checkEmbeddedMedia,detail:c.detail.checkEmbeddedMedia})}),$(e).find("a[href]").each(function(){var e,t;e=(t=$(this).attr("href")).replace(/\?.*$/,"").replace(/.*\//,"").split(".").pop(),(r.test(e)||i.test(t))&&c.errors.push({id:n,idx:o,code:c.outerHtmlSummary(this),msg:c.message.checkEmbeddedMedia,detail:c.detail.checkEmbeddedMedia})})})},c}(),this.Form_Checker=function(){function o(e){this.$el=null,this.$elBody=null,this.form=e}function i(e,t){this.$el=$(e),this.form=t,this.resultBox=new o(t)}return o.prototype.init=function(){if(this.$el)return this;var e=$("#errorFormChecker");if(e[0])return this.$el=e,this.$elBody=e.find(".errorExplanationBody"),this.moveLast();(e=$("<div/>",{id:"errorFormChecker","class":"errorExplanation"})).append("<h2>"+i.message.header+"</h2>");var t=$("<div/>",{"class":"errorExplanationBody"});return e.append(t),this.$el=e,this.$elBody=t,this.moveLast()},o.prototype.moveLast=function(){return $(this.form.addonSelector).append(this.$el),this},o.prototype.showMessage=function(e){return this.init(),this.$elBody.html(e),this.moveLast(),this},o.prototype.showChecking=function(){return this.showMessage(SS.loading)},o.prototype.showResult=function(e){if(!e||0==e.length)return this.$elBody.html(""),void this.$elBody.append("<p>"+i.message.noErrors+"</p>");var t=$("<ul/>");return $.each(e,function(){t.append("<li>"+this+"</li>")}),this.$elBody.html(""),this.$elBody.append("<p>"+i.message.body+"</p>"),this.$elBody.append(t),this.moveLast()},i.message={header:"\u5236\u7d04\u30c1\u30a7\u30c3\u30af",body:"\u6b21\u306e\u9805\u76ee\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002",noErrors:"\u30a8\u30e9\u30fc\u306f\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002",formCheckerError:"\u5185\u5bb9\u30c1\u30a7\u30c3\u30af\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u6b21\u306eURL\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3002"},i.render=function(e){e=e||Cms_Form;var t=new i(document,e);return t.render(),t},i.prototype.render=function(){var o=this;this.$el.on("click","button.form-check",function(){var e=this;e.disabled=!0;var t=function(){e.disabled=!1};o.asyncCheck().done(t).fail(t)})},i.prototype.asyncCheck=function(){var r=$.Deferred();this.resultBox.showChecking();var e=this.form.getFormData($("#"+Form_Preview.form_id)),t=this;return $.ajax({type:"POST",url:this.form.form_check_path,data:e,processData:!1,contentType:!1,cache:!1,success:function(e){t.resultBox.showResult(e),r.resolve({status:e&&0<e.length?"error":"ok"})},error:function(e,t,o){var n=i.message.formCheckerError+": "+form.form_check_path;i.resultBox.showMessage("<p>"+n+"</p>"),r.reject(e,t,o)}}),r.promise()},i}(),this.Mobile_Size_Checker=function(){function e(){this.$el=null,this.$elBody=null}function p(){}return e.prototype.init=function(){if(this.$el)return this;var e=$("#errorMobileChecker");if(e[0])return this.$el=e,this.$elBody=e.find(".errorExplanationBody"),this.moveLast();(e=$("<div/>",{id:"errorMobileChecker","class":"errorExplanation"})).append("<h2>"+p.message.header+"</h2>");var t=$("<div/>",{"class":"errorExplanationBody"});return e.append(t),this.$el=e,this.$elBody=t,this.moveLast()},e.prototype.moveLast=function(){return $(Cms_Form.addonSelector).append(this.$el),this},e.prototype.showMessage=function(e){return this.init(),this.$elBody.html(e),this.moveLast(),this},e.prototype.showChecking=function(){return this.showMessage(SS.loading)},e.prototype.showResult=function(){if(0===p.error.length)return this.showMessage("<p>"+p.message.mobile_check+"</p>");var e=p.error;this.$elBody.html("");for(var t=0,o=e.length;t<o;t++){var n=e[t];this.$elBody.append('<p class="error">'+n+"</p>")}return this.moveLast()},p.message={header:"\u643a\u5e2f\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u30c1\u30a7\u30c3\u30af",body:"",success:"\u6210\u529f",failure:"\u5931\u6557",mobile_disable:"\u30e2\u30d0\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",mobile_check:"\u672c\u6587\u306e\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u306fOK\u3067\u3059\u3002",SizeCheckServerError:"\u672c\u6587\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u306e\u30c1\u30a7\u30c3\u30af\u4e2d\u306b\u30b5\u30fc\u30d0\u30fc\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"},p.error=[],p.url="/.cms/mobile_size_check/check.json",p.rootUrl="",p.imgs=[],p.hostFullUrl="",p.resultBox=new e,p.render=function(){return $(document).on("click","button.mobile-size-check",function(){if(p.enabled){var t=this;t.disabled=!0,p.resultBox.showChecking(),p.reset();var e=function(e){p.check(e,function(){p.resultBox.showResult(),t.disabled=!1})},o=function(){p.resultBox.showMessage("<p>"+p.message.SizeCheckServerError+"</p>"),t.disabled=!1};Cms_Form.getHtml(e,o)}else p.resultBox.showMessage("<p>"+p.message.mobile_disable+"</p>")})},p.reset=function(){this.message.body="",this.imgs={},this.error=""},p.get_str_byte=function(e){var t,o,n,r,i;if(t=";,/?:@&=+$ ",o=[0,1,1,1,2,3,2,3,4,3],i=0,null===e||""===e)return i;for(r in e)if(n=e[r],0<=t.indexOf(n))i++;else try{i+=o[encodeURI(n).length]}catch(a){console.error("Mobile_Size_Checker.get_str_byte failed : "+a)}return i},p.check=function(e,t){var o,n,r,i,a,s,l,c,d,h,u;if((s=p.mobile_size)<(c=p.get_str_byte(e)))return o='<p class="error">',o+=p.message.SizeCheckError,o+="(\u672c\u6587\u30b5\u30a4\u30ba\uff1a"+parseInt(c/1024)+"KB)",o+="</p>",p.error=[o],void t();for(n=[],r={},i=0,a=(l=$(e).find("img[src]")).length;i<a;i++)d=l[i],(h=(u=(u=$(d).attr("src")).replace(p.hostFullUrl.replace(/\/$/,""),"")).match(/^\/fs\/(.+?)\/_\//))&&(r[h[1].replace(/\//g,"")]=u.match(/_\/thumb\//),n.push(parseInt(h[1].replace(/\//g,""))));0!=n.length?$.ajax({type:"POST",url:p.url,cache:!1,data:JSON.stringify({img_ids:n,mobile_size:s,is_thumb:r}),contentType:"application/json",dataType:"json",crossDomain:!0,success:function(e){if(0<e.errors.length)return p.error=e.errors},error:function(){var e;e="<p>",e+=p.message.SizeCheckServerError,e+="</p>",p.error=[e]},complete:function(){t()}}):t()},p.asyncCheckHtmlSize=function(e){var t=$.Deferred();return p.reset(),p.enabled?(p.resultBox.showChecking(),p.check(e,function(){p.resultBox.showResult(),t.resolve()})):t.resolve(),t.promise()},p.asyncValidateHtml=function(e,t,o){var n=p.asyncCheckHtmlSize(o.html);return n.done(function(){if(0!==p.error.length)for(var e=0,t=p.error.length;e<t;e++){var o=p.error[e];Form_Alert.add("\u643a\u5e2f\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u30c1\u30a7\u30c3\u30af",this,o)}}),n},p}(),this.Link_Checker=function(){function o(e){this.$el=null,this.$elBody=null,this.form=e}function a(e,t){this.$el=$(e),this.form=t,this.links={},this.linkErrorCount=0,this.resultBox=new o(t)}return o.prototype.init=function(){if(this.$el)return this;var e=$("#errorLinkChecker");if(e[0])return this.$el=e,this.$elBody=e.find(".errorExplanationBody"),this.moveLast();(e=$("<div/>",{id:"errorLinkChecker","class":"errorExplanation"})).append("<h2>"+a.message.header+"</h2>");var t=$("<div/>",{"class":"errorExplanationBody"});return e.append(t),this.$el=e,this.$elBody=t,this.moveLast()},o.prototype.moveLast=function(){return $(this.form.addonSelector).append(this.$el),this},o.prototype.showMessage=function(e){return this.init(),this.$elBody.html(e),this.moveLast(),this},o.prototype.showChecking=function(){return this.showMessage(SS.loading)},o.prototype.showResult=function(e){var o=$("<ul/>");return $.each(e,function(e,t){o.append("<li>"+t+"</li>")}),this.$elBody.html(""),this.$elBody.append("<p>"+a.message.checkLinks+"</p>"),this.$elBody.append(o),this.moveLast()},a.message={header:"\u30ea\u30f3\u30af\u30c1\u30a7\u30c3\u30af",noLinks:"\u30ea\u30f3\u30af\u306f\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002",checkLinks:"\u6b21\u306e\u30ea\u30f3\u30af\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002",success:"[\u6210\u529f]",failure:"[\u5931\u6557]",linkCheckerError:"\u30ea\u30f3\u30af\u30c1\u30a7\u30c3\u30af\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u6b21\u306eURL\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3002"},a.url="/.cms/link_check/check.json",a.rootUrl="",a.instance=null,a.render=function(e){e=e||Cms_Form;var t=a.instance=new a(document,e);return t.render(),t},a.reset=function(){a.instance&&a.instance.reset()},a.prototype.render=function(){var o=this;return this.$el.on("click","button.link-check",function(){var e=this;e.disabled=!0;var t=function(){e.disabled=!1};o.asyncCheck().done(t).fail(t)})},a.prototype.asyncCheck=function(){return".mod-cms-body"===this.form.addonSelector?this.asyncCheckInEditor():this.asyncCheckInForm()},a.prototype.asyncCheckInEditor=function(){var r=this,i=$.Deferred();this.beforeCheck();var o=$(this.form.getEditorHtml()),n=[];return o.find("a[href]").each(function(){var e=$(this).attr("href");if("#"!==e)if("#"===e[0]){var t=0!=o.find(e).length?200:0;r.addMessage(e,{code:t})}else/^\//.test(e)&&(e=a.rootUrl+e.slice(1)),n.push(e)}),0===n.length?(SS.isEmptyObject(this.links)?this.resultBox.showMessage("<p>"+a.message.noLinks+"</p>"):this.resultBox.showResult(this.links),i.resolve({status:0===this.linkErrorCount?"ok":"failed"})):$.ajax({type:"POST",url:a.url,cache:!1,data:JSON.stringify({url:n,root_url:a.rootUrl}),contentType:"application/json",dataType:"json",crossDomain:!0,success:function(e){$.each(e,function(e,t){r.addMessage(e,t)}),r.resultBox.showResult(r.links),i.resolve({status:0===r.linkErrorCount?"ok":"failed"})},error:function(e,t,o){var n=a.message.linkCheckerError+": "+a.url;r.resultBox.showMessage("<p>"+n+"</p>"),i.reject(e,t,o)}}),i.promise()},a.prototype.asyncCheckInForm=function(){var r=this,i=$.Deferred();if(this.beforeCheck(),!this.form.form_link_check_path){var e="form link check path is not configured";return this.resultBox.showMessage("<p>"+e+"</p>"),void i.reject(null,null,e)}var t=this.form.getFormData($("#"+Form_Preview.form_id));t.append("route",Form_Preview.page_route);var o="ok";return $.ajax({type:"POST",url:r.form.form_link_check_path,data:t,processData:!1,contentType:!1,cache:!1,success:function(e){if(!e||0===e.length)return r.resultBox.showMessage("<p>"+a.message.noLinks+"</p>"),void i.resolve({status:o});$.each(e,function(e,t){r.addMessage(e,t),200!=t.code&&(o="failed")}),r.resultBox.showResult(r.links),i.resolve({status:o})},error:function(e,t,o){var n=a.message.linkCheckerError+": "+r.form.form_link_check_path;r.resultBox.showMessage("<p>"+n+"</p>"),i.reject(e,t,o)}}),i.promise()},a.prototype.reset=function(){this.links={},this.linkErrorCount=0},a.prototype.beforeCheck=function(){this.reset(),$.support.cors=!0,this.resultBox.showChecking()},a.prototype.addMessage=function(e,t){var o=t.code,n=t.message,r="";200==o?(r+='<span class="success">'+a.message.success+"</span> ",r+='<span class="url">'+e+"</span> "):(r+='<span class="failure">'+a.message.failure+"</span> ",r+='<span class="url">'+e+"</span> ",this.linkErrorCount++),n&&(r+='<div class="message detail">',r+=n,r+="</div>"),this.links[e]=r},a}(),Cms_TemplateForm=function(e){this.options=e,this.$formChangeBtn=$("#addon-basic .btn-form-change"),this.$formSelect=$("#addon-basic .form-change"),this.$formIdInput=$('#addon-basic [name="item[form_id]"]'),this.$formPage=$("#addon-cms-agents-addons-form-page"),this.$formPageBody=this.$formPage.find(".addon-body"),this.selectedFormId=null,Cms_TemplateForm.target&&this.bind(Cms_TemplateForm.target.el,Cms_TemplateForm.target.options)},Cms_TemplateForm.instance=null,Cms_TemplateForm.userId=null,Cms_TemplateForm.target=null,Cms_TemplateForm.confirms={},Cms_TemplateForm.paths={},Cms_TemplateForm.duration=400,Cms_TemplateForm.render=function(e){if(!Cms_TemplateForm.instance){var t=new Cms_TemplateForm(e);t.render(),Cms_TemplateForm.instance=t}},Cms_TemplateForm.bind=function(e,t){Cms_TemplateForm.instance?Cms_TemplateForm.instance.bind(e,t):(Cms_TemplateForm.target.el=e,Cms_TemplateForm.target.options=t)},Cms_TemplateForm.createElementFromHTML=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},Cms_TemplateForm.prototype.render=function(){var e=this;this.$formChangeBtn.on("click",function(){e.changeForm()}),this.$formSelect.on("change",function(){setTimeout(function(){confirm(Cms_TemplateForm.confirms.changeForm)?e.changeForm():e.$formSelect.val(e.$formIdInput.val())},13)})},Cms_TemplateForm.prototype.changeForm=function(){if(".mod-body-part-html"===Cms_Form.addonSelector)return!1;var e=this.$formSelect.val();e?this.selectedFormId&&this.selectedFormId===e?this.activateForm(e):(this.loadAndActivateForm(e),this.selectedFormId=e):this.deactivateForm()},Cms_TemplateForm.prototype.loadAndActivateForm=function(n){var r=this;this.$formChangeBtn.prop("disabled",!0),$.ajax({url:Cms_TemplateForm.paths.formUrlTemplate.replace(":id",n),type:"GET",success:function(e){r.loadForm(e),r.activateForm(n)},error:function(e,t,o){r.showError(o),r.activateForm(n)},complete:function(){r.$formChangeBtn.prop("disabled",!1)}})},Cms_TemplateForm.prototype.loadForm=function(e){this.$formPage.html($(e).html()),SS.renderAjaxBox(),SS.renderDateTimePicker()},Cms_TemplateForm.prototype.showError=function(e){this.$formPageBody.html("<p>"+e+"</p>")},Cms_TemplateForm.prototype.activateForm=function(e){this.$formPage.removeClass("hide"),$("#addon-cms-agents-addons-body").addClass("hide"),$("#addon-cms-agents-addons-body_part").addClass("hide"),$("#addon-cms-agents-addons-file").addClass("hide"),$("#addon-cms-agents-addons-form-page").removeClass("hide"),$("#item_body_layout_id").parent("dd").prev("dt").addClass("hide"),$("#item_body_layout_id").parent("dd").addClass("hide"),Cms_Form.addonSelector="#addon-cms-agents-addons-form-page .addon-body",Cms_Form.activateSyntaxChecks(),this.$formIdInput.val(e),this.$formChangeBtn.trigger("ss:formActivated")},Cms_TemplateForm.prototype.deactivateForm=function(){this.$formPageBody.html(""),this.$formPage.addClass("hide"),$("#addon-cms-agents-addons-body").removeClass("hide"),$("#addon-cms-agents-addons-body_part").addClass("hide"),$("#addon-cms-agents-addons-file").removeClass("hide"),$("#addon-cms-agents-addons-form-page").addClass("hide"),$("#item_body_layout_id").parent("dd").prev("dt").removeClass("hide"),$("#item_body_layout_id").parent("dd").removeClass("hide"),Cms_Form.addonSelector=".mod-cms-body",Cms_Form.activateSyntaxChecks(),this.$formIdInput.val(""),this.$formChangeBtn.trigger("ss:formDeactivated")},Cms_TemplateForm.prototype.bind=function(e,t){(!this.el||this.el!==e)&&this.bindOne(e,t),this.resetOrder()},Cms_TemplateForm.prototype.bindOne=function(e,t){this.el=e,this.$el=$(e);var o=this;this.$el.on("change",".column-value-controller-move-position",function(){o.movePosition($(this))}),this.$el.on("click",".column-value-controller-move-up",function(){o.moveUp($(this))}),this.$el.on("click",".column-value-controller-move-down",function(){o.moveDown($(this))}),this.$el.on("click",".column-value-controller-delete",function(){o.remove($(this))}),this.$el.on("click",".column-value-palette [data-form-id]",function(){var n=$(this),e=n.data("form-id"),t=n.data("column-id");n.closest("fieldset").prop("disabled",!0),n.css("cursor","wait"),n.closest(".column-value-palette").find(".column-value-palette-error").addClass("hide").html(""),$.ajax({url:Cms_TemplateForm.paths.formColumn.replace(/:formId/,e).replace(/:columnId/,t),success:function(e){var t=Cms_TemplateForm.createElementFromHTML(e);n.closest(".column-value-palette").before(t),o.resetOrder(),setTimeout(function(){SS.renderAjaxBox(),SS.renderDateTimePicker(),Cms_Form.activateSyntaxChecks(),setTimeout(function(){n.trigger("ss:columnAdded",t)},0)},0)},error:function(e,t,o){n.closest(".column-value-palette").find(".column-value-palette-error").html(o).removeClass("hide")},complete:function(){n.css("cursor","pointer"),n.closest("fieldset").prop("disabled",!1)}})}),t&&"entry"===t.type&&this.$el.find(".addon-body").sortable({axis:"y",handle:".sortable-handle",items:"> .column-value",beforeStop:function(e,t){t.item.trigger("column:beforeMove")},stop:function(e,t){t.item.trigger("column:afterMove")},update:function(){o.resetOrder()}})},Cms_TemplateForm.prototype.resetOrder=function(){for(var e=this.$el.find(".column-value").length,t='<option value=":value">:display</option>',o=[],n=0;n<e;n++)o.push(t.replace(":value",n.toString()).replace(":display",(n+1).toString()));this.$el.find(".column-value").each(function(e){var t=$(this).find(".column-value-controller-move-position");t.html(o.join("")),t.val(e)})},Cms_TemplateForm.prototype.movePosition=function(e){var t=this,o=e.val();if(o){o=parseInt(o);var n,r,i=e.closest(".column-value"),a=i[0],s=this.$el.find(".column-value"),l=-1;if(s.each(function(e){if(this===a)return l=e,!1}),!(l<0))if(!(o===l||o>=s.length||o<0))o<l?(n=$(s[o]),r=n.before.bind(n)):(n=$(s[o]),r=n.after.bind(n)),Cms_TemplateForm.insertElement(i,n,function(){i.trigger("column:beforeMove"),r(i),t.resetOrder(),i.trigger("column:afterMove")})}},Cms_TemplateForm.prototype.moveUp=function(e){var t=e.closest(".column-value");if(t[0]){var o=t.prev(".column-value");if(o[0]){var n=this;Cms_TemplateForm.swapElement(o,t,function(){t.trigger("column:beforeMove"),o.before(t),n.resetOrder(),t.trigger("column:afterMove")})}}},Cms_TemplateForm.prototype.moveDown=function(e){var t=e.closest(".column-value");if(t[0]){var o=t.next(".column-value");if(o[0]){var n=this;Cms_TemplateForm.swapElement(t,o,function(){t.trigger("column:beforeMove"),o.after(t),n.resetOrder(),t.trigger("column:afterMove")})}}},Cms_TemplateForm.swapElement=function(e,t,o){var n=e[0],r=t[0],i=r.offsetTop-n.offsetTop,a=r.offsetTop-(n.offsetTop+n.offsetHeight);n.style.transitionDuration=Cms_TemplateForm.duration+"ms",r.style.transitionDuration=Cms_TemplateForm.duration+"ms",n.style.transform="translateY("+(r.offsetHeight+a)+"px)",r.style.transform="translateY("+-i+"px)",setTimeout(function(){n.style.transitionDuration="",r.style.transitionDuration="",n.style.transform="",r.style.transform="",o()},Cms_TemplateForm.duration)},Cms_TemplateForm.insertElement=function(e,t,o){var n=e[0],r=t[0];if(n!==r){var i,a,s=[];if(r.offsetTop<n.offsetTop){if(n===r.nextElementSibling)return void Cms_TemplateForm.swapElement(t,e,o);var l=n.offsetTop+n.offsetHeight,c=n.previousElementSibling,d=c.offsetTop+c.offsetHeight;i=r.offsetTop-n.offsetTop,a=l-d;for(var h=r;h!==n;)s.push(h),h=h.nextElementSibling}else if(r.offsetTop>n.offsetTop){if(n===r.previousElementSibling)return void Cms_TemplateForm.swapElement(e,t,o);var u=r.offsetTop+r.offsetHeight,p=(l=n.offsetTop+n.offsetHeight,n.nextElementSibling);i=u-l,a=n.offsetTop-p.offsetTop;for(h=r;h!==n;)s.push(h),h=h.previousElementSibling}n.style.transitionDuration=Cms_TemplateForm.duration+"ms",n.style.transform="translateY("+i+"px)",s.forEach(function(e){e.style.transitionDuration=Cms_TemplateForm.duration+"ms",e.style.transform="translateY("+a+"px)"}),setTimeout(function(){n.style.transitionDuration="",n.style.transform="",s.forEach(function(e){e.style.transitionDuration="",e.style.transform=""}),o()},Cms_TemplateForm.duration)}else o()},Cms_TemplateForm.prototype.remove=function(e){var t=e.closest(".column-value");if(t[0]&&confirm(Cms_TemplateForm.confirms["delete"])){var o=this;t.addClass("column-value-deleting").fadeOut(Cms_TemplateForm.duration).queue(function(){var e=t.find(".column-value-body .html").attr("id");e&&CKEDITOR.instances[e].destroy(),t.remove(),o.resetOrder(),Cms_Form.activateSyntaxChecks()})}},SS_Workflow=function(e,t){this.$el=$(e),this.options=t;var r=this;this.$el.on("click",".update-item",function(e){return r.updateItem($(this)),e.preventDefault(),!1}),$(document).on("click",".mod-workflow-approve .update-item",function(e){return r.updateItem($(this)),e.preventDefault(),!1}),$(document).on("click",".mod-workflow-view .request-cancel",function(e){return r.cancelRequest($(this)),e.preventDefault(),!1}),this.$el.find(".mod-workflow-approve").insertBefore("#addon-basic"),this.$el.find(".toggle-label").on("click",function(e){return r.$el.find(".request-setting").slideToggle(),e.preventDefault(),!1}),this.$el.find(".workflow-partial-section")[0]&&r.loadRouteList(),this.$el.on("click",".workflow-route-start",function(e){var t=$(this).siblings("#workflow_route:first").val();return r.loadRoute(t),e.preventDefault(),!1}),this.$el.on("click",".workflow-route-cancel",function(e){return r.loadRouteList(),e.preventDefault(),!1}),this.$el.on("click",".workflow-reroute",function(e){var t=$(this),o=t.data("level"),n=t.data("user-id");return r.reroute(o,n),e.preventDefault(),!1}),$(".mod-workflow-approve .btn-file-upload").data("on-select",function(e){$.colorbox.close(),r.onUploadFileSelected(e)}),this.tempFile=new SS_Addon_TempFile(".mod-workflow-approve .upload-drop-area",this.options.user_id,{select:function(e,t){r.onDropFile(e,t)}}),$(".update-item").each(function(){this.disabled=!1}),SS_Workflow.updateDisabled=!1},SS_Workflow.updateDisabled=!0,SS_Workflow.prototype={collectApprovers:function(){var e=[];return this.$el.find(".workflow-multi-select").each(function(){e=e.concat($(this).val())}),this.$el.find("input[name='workflow_approvers']").each(function(){e.push($(this).prop("value"))}),e},collectApproverAttachmentUses:function(){var e=[];return this.$el.find("input[name='workflow_approver_attachment_uses']").each(function(){e.push($(this).prop("value"))}),e},collectCirculations:function(){var e=[];return this.$el.find("input[name='workflow_circulations']").each(function(){e.push($(this).prop("value"))}),e},agentType:function(){return this.$el.find("input[name=agent_type]:checked").val()},collectDelegatees:function(){var e=[];return"agent"!==this.agentType()||this.$el.find("input[name='workflow_delegatees']").each(function(){e.push($(this).prop("value"))}),e},collectCirculationAttachmentUses:function(){var e=[];return this.$el.find("input[name='workflow_circulation_attachment_uses']").each(function(){e.push($(this).prop("value"))}),e},collectFileIds:function(){var e=[];return $("input[name='workflow_file_ids[]']").each(function(){e.push($(this).prop("value"))}),e},composeWorkflowUrl:function(e){if(this.options&&this.options.paths&&this.options.paths[e])return this.options.paths[e];var t=location.pathname.split("/");return t[2]=this.options.workflow_node,t[3]=e,5<t.length&&t.splice(4,1),t.join("/")},updateItem:function(n){var t=this,e=n.attr("updatetype"),o=this.collectApprovers();if(SS.isEmptyObject(o)&&"request"===e)alert(this.options.errors.not_select);else{var r=[];this.$el.find("input[name='workflow_required_counts']").each(function(){r.push($(this).prop("value"))});var i=this.composeWorkflowUrl("pages");i+="/"+e+"_update";var a,s=$("#workflow_comment").prop("value"),l=$("#workflow_pull_up").prop("value"),c=$("#workflow_on_remand").prop("value"),d=$("#remand_comment").prop("value");a="request"==e?$("#forced-request").prop("checked"):$("#forced-update").prop("checked");var h=this.collectCirculations(),u=this.collectFileIds();if(SS_Workflow.updateDisabled)return!1;SS_Workflow.updateDisabled=!0,n.prop("disabled",!0),$.ajax({type:"POST",url:i,data:{workflow_comment:s,workflow_pull_up:l,workflow_on_remand:c,workflow_approvers:o,workflow_required_counts:r,workflow_approver_attachment_uses:this.collectApproverAttachmentUses(),remand_comment:d,url:this.options.request_url,forced_update_option:a,workflow_circulations:h,workflow_circulation_attachment_uses:this.collectCirculationAttachmentUses(),workflow_file_ids:u,workflow_agent_type:this.agentType(),workflow_users:this.collectDelegatees()},success:function(e){if(e.workflow_alert)return alert(e.workflow_alert),n.prop("disabled",!1),void(SS_Workflow.updateDisabled=!1);e.redirect&&e.redirect.reload?location.reload():e.redirect&&e.redirect.show?location.href=e.redirect.show:"approve"===e.workflow_state&&t.options.redirect_location?location.href=t.options.redirect_location:location.reload()},error:function(e){try{var t=$.parseJSON(e.responseText);alert(["== Error =="].concat(t).join("\n"))}catch(o){alert(["== Error =="].concat(e.statusText).join("\n"))}n.prop("disabled",!1),SS_Workflow.updateDisabled=!1}})}},cancelRequest:function(e){var t=e.data("ss-confirmation");if(t&&!confirm(t))return!1;var o=e.data("ss-method")||"post",n=e.attr("href"),r=$('meta[name="csrf-token"]').attr("content"),i=e.html();e.prop("disabled",!0),e.html(SS.loading),$.ajax({type:o,url:n,data:{authenticity_token:r},success:function(e){e.workflow_alert?alert(e.workflow_alert):"approve"===e.workflow_state&&""!==redirect_location?location.href=redirect_location:location.reload()},error:function(e){var t;try{var o=$.parseJSON(e.responseText);t=["== Error =="].concat(o).join("\n")}catch(n){t=["== Error =="].concat(e.statusText).join("\n")}alert(t)},complete:function(){e.html(i),e.prop("disabled",!1)}})},loadRouteList:function(){var r=this,e=this.composeWorkflowUrl("wizard");r.$el.find(".workflow-partial-section").html(SS.loading),$.ajax({type:"GET",url:e,success:function(e){r.$el.find(".workflow-partial-section").html(e)},error:function(e){var t;try{var o=$.parseJSON(e.responseText);t=["== Error =="].concat(o).join("\n")}catch(n){t=["== Error =="].concat(e.statusText).join("\n")}r.$el.find(".workflow-partial-section").html('<div class="error">'+t+"</div>"),alert(t)}})},loadRoute:function(e){var n=this,t=this.composeWorkflowUrl("wizard");t+="/approver_setting";var o={route_id:e};n.$el.find(".workflow-partial-section").html(SS.loading),$.ajax({type:"POST",url:t,data:o,success:function(e){n.$el.find(".workflow-partial-section").html(e)},error:function(e){var t;try{t=$.parseJSON(e.responseText).join("\n")}catch(o){t=["== Error =="].concat(e.statusText).join("\n")}n.$el.find(".workflow-partial-section").html(t),alert(t)}})},reroute:function(n,r){var e=this.composeWorkflowUrl("wizard");e+="/reroute",e+="?"+$.param({level:n,user_id:r});var i=this;$("<a/>").attr("href",e).colorbox({fixed:!0,width:"90%",height:"90%",open:!0,onCleanup:function(){var e=$("#cboxLoadedContent input[name=selected_user_id]").val();if(e){var t=i.composeWorkflowUrl("wizard");t+="/reroute";var o={level:n,user_id:r,new_user_id:e,url:i.options.request_url};$.ajax({type:"POST",url:t,data:o,success:function(){location.reload()},error:function(e){try{var t=$.parseJSON(e.responseText);alert(t.join("\n"))}catch(o){alert(["== Error =="].concat(e.statusText).join("\n"))}}})}}})},fileSelectViewUrl:function(e){return"/.u:user/apis/temp_files/:id/select.html".replace(/:user/g,this.options.user_id).replace(/:id/g,e)},onUploadFileSelected:function(e){var t=this;$.ajax({url:this.fileSelectViewUrl(e.closest("[data-id]").data("id")),success:function(e){t.renderFileHtml(e)},error:function(){alert("== Error ==")}})},renderFileHtml:function(e){var t=this,o=$(e);o.find("input[name='item[file_ids][]']").attr("name","workflow_file_ids[]"),o.find(".action .action-delete").removeAttr("onclick","").on("click",function(e){return e.preventDefault(),t.deleteUploadedFile($(this)),!1}),o.find(".action .action-attach").remove(),o.find(".action .action-paste").remove(),o.find(".action .action-thumb").remove(),$("#selected-files").append(o)},deleteUploadedFile:function(e){e.closest("div[data-file-id]").remove()},onDropFile:function(e){for(var t=this,o=0,n=e.length;o<n;o++){var r=e[o]._id,i=t.fileSelectViewUrl(r);$.ajax({url:i,success:function(e){t.renderFileHtml(e)},error:function(){alert("== Error ==")}})}}},SS_WorkflowRerouteBox=function(e,t){this.$el=$(e),this.options=t;var o=this;this.$el.find("form.search").on("submit",function(e){$(this).ajaxSubmit({url:$(this).attr("action"),success:function(e){o.$el.closest("#cboxLoadedContent").html(e)},error:function(){alert("== Error ==")}}),e.preventDefault()}),this.$el.find(".pagination a").on("click",function(e){var t=$(this).attr("href");return o.$el.closest("#cboxLoadedContent").load(t,function(e,t){"error"===t&&alert("== Error ==")}),e.preventDefault(),!1}),this.$el.find(".select-single-item").on("click",function(e){var t=$(this);if(!SS.disableClick(t))return!1;o.selectItem(t),e.preventDefault(),$.colorbox.close()})},SS_WorkflowRerouteBox.prototype={selectItem:function(e){var t=e.closest(".list-item"),o=t.data("id"),n=t.data("name"),r=t.data("email"),i=this.$el.data("name"),a=this.$el.data("email");i&&a&&(i+="("+a+")");var s="";i&&(s+=i,s+="\u3092"),s+=n+"("+r+")\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",confirm(s)&&this.$el.find("input[name=selected_user_id]").val(o)}},SS_WorkflowApprover=function(e){this.options=e,this.render()},SS_WorkflowApprover.prototype.render=function(){var e=this;$("#addon-workflow-agents-addons-approver").remove();var t=$("#item_state").parent();t.prev().remove(),t.remove(),e.options.close_confirmation&&($(".save").attr("data-close-confirmation",e.options.close_confirmation),e.options.contain_links_path&&$(".save").attr("data-contain-links-path",e.options.contain_links_path)),e.options.draft_save&&$(".save").val(e.options.draft_save).attr("data-disable-with",null).attr("data-disable","").on("click",function(){return e.onClickSave(),!0}),e.options.branch_save&&$("<input />").attr("type","submit").val(e.options.branch_save).attr("name","branch_save").attr("class","branch_save").attr("data-disable","").on("click",function(){return!0}).insertAfter("#item-form input.save"),e.options.publish_save&&$("<input />").attr("type","submit").val(e.options.publish_save).attr("name","publish_save").attr("class","publish_save").attr("data-disable","").on("click",function(){return e.onPublishSaveClicked(),!0}).insertAfter("#item-form input.save"),"request"===e.options.workflow_state&&$("<input />").attr("type","hidden").attr("name","item[workflow_cancel_request]").attr("value",!0).appendTo("#item-form"),Form_Save_Event.render()},SS_WorkflowApprover.prototype.onClickSave=function(){var e=this;e.addOrUpdateInput("item[state]","closed"),e.addOrUpdateInput("item[workflow_reset]",null)},SS_WorkflowApprover.prototype.onPublishSaveClicked=function(){var e=this;e.addOrUpdateInput("item[state]","public"),e.addOrUpdateInput("item[workflow_reset]","1")},SS_WorkflowApprover.prototype.addOrUpdateInput=function(e,t){var o=$("#item-form").find("input[name='"+e+"']");0<o.length?o.val(t):$("<input />").attr("type","hidden").attr("name",e).attr("value",t).appendTo("#item-form")},this.SS_Addon_TempFile=function(){function o(e,t,o){this.$selector=$(e.selector||e),this.userId=t,this.dropEventTriggered=null,o&&o.select&&(this.select=o.select),o&&o.selectUrl&&(this.selectUrl=o.selectUrl),o&&o.uploadUrl&&(this.uploadUrl=o.uploadUrl),this.render()}return o.renderDrop=function(e,t){return new o(e,t,{})},o.prototype.select=function(e){for(var o=[],t=[],n=0;n<e.length;n++){var r=e[n]._id,i=this.selectUrl(r),a={};$("#show-file-size").val()&&(a.file_size=$("#show-file-size").val()),t.push($.ajax({url:i,data:a,success:function(e){var t=$(e).find(".name").text().trim()
;o.push({name:t,data:e})}}))}$.when.apply($,t).done(function(){o.sort(function(e,t){return e.name<t.name?1:e.name>t.name?-1:0});for(var e=0;e<o.length;e++)$("#selected-files").prepend(o[e].data)})},o.prototype.selectUrl=function(e){return"/.u"+this.userId+"/apis/temp_files/"+e+"/select"},o.prototype.uploadUrl=function(){return"/.u"+this.userId+"/apis/temp_files.json"},o.prototype.render=function(){var t=this;$(document).on("dragenter",t.$selector,function(e){if(e.target===t.$selector[0])return t.onDragEnter(e),!1}),$(document).on("dragleave",t.$selector,function(e){if(e.target===t.$selector[0])return t.onDragLeave(e),!1}),$(document).on("dragover",t.$selector,function(e){if(e.target===t.$selector[0]||$.contains(t.$selector[0],e.target))return t.onDragOver(e),!1}),$(document).on("drop",t.$selector,function(e){if(e.target===t.$selector[0]||$.contains(t.$selector[0],e.target))return t.onDrop(e)})},o.prototype.onDragEnter=function(){this.$selector.addClass("file-dragenter")},o.prototype.onDragLeave=function(){this.$selector.removeClass("file-dragenter")},o.prototype.onDragOver=function(){this.$selector.hasClass("file-dragenter")||this.$selector.addClass("file-dragenter")},o.prototype.onDrop=function(e){var n=this,t=$('meta[name="csrf-token"]').attr("content"),o=new FormData;o.append("authenticity_token",t);var r=SS_AjaxFile.defaultFileResizing();r&&o.append("item[resizing]",r);var i=e.originalEvent.dataTransfer.files;if(0===i.length)return!1;if(n.dropEventTriggered)return!1;n.dropEventTriggered=!0;for(var a=0,s=i.length;a<s;a++)o.append("item[in_files][]",i[a]);var l=new XMLHttpRequest;return l.onload=function(){if(l.readyState===XMLHttpRequest.DONE){if(n.$selector.removeClass("file-dragenter"),200===l.status||201===l.status){var e=JSON.parse(l.response);n.select(e,n.$selector)}else if(413===l.status)alert(["== Error =="].concat("\u30c7\u30fc\u30bf\u306e\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3059\u304e\u307e\u3059\u3002").join("\n"));else try{var t=$.parseJSON(l.response);alert(["== Error =="].concat(t).join("\n"))}catch(o){alert(["== Error =="].concat(l.statusText).join("\n"))}n.dropEventTriggered=!1}},l.open("POST",n.uploadUrl()),l.send(o),!1},o}(),this.SS_SearchUI=function(){function n(){}return n.anchorAjaxBox,n.defaultSelector=function(e){var t,o,n,r,i,a,s;a=this,n=(o=e.closest("[data-id]")).data("id"),i=o.data("name")||o.find(".select-item").text()||e.text()||o.text(),s=$("<tr />").attr("data-id",n),r=(r=a.anchorAjaxBox.closest("dl").find(".hidden-ids").clone(!1)).val(n).removeClass("hidden-ids"),t=$('<a class="deselect btn" href="#">\u524a\u9664</a>'),s.append($("<td />").append(r).append(i)),s.append($("<td />").append(t)),a.anchorAjaxBox.closest("dl").find(".ajax-selected tbody").prepend(s),a.anchorAjaxBox.closest("dl").find(".ajax-selected").trigger("change")},n.defaultDeselector=function(e){var t=$(e).closest(".ajax-selected");$(e).closest("tr").remove(),0===t.find("tbody tr").size()&&t.hide(),t.trigger("change")},n.select=function(e){var t=this.anchorAjaxBox.data("on-select");return t?t(e):this.defaultSelector(e)},n.selectItems=function(e){e||(e=$("#ajax-box"));var t=this;e.find(".items input:checkbox").filter(":checked").each(function(){t.select($(this))}),t.anchorAjaxBox.closest("dl").find(".ajax-selected").show()},n.deselect=function(e){var t=$(this),o=t.closest(".ajax-selected").data("on-deselect");o?o(t):n.defaultDeselector(t),e.preventDefault()},n.toggleSelectButton=function(e){return e||(e=$("#ajax-box")),0<e.find(".items input:checkbox").filter(":checked").size()?e.find(".select-items").parent("div").show():e.find(".select-items").parent("div").hide()},n.render=function(){var e=this;$(".ajax-selected").each(function(){$(this).on("click",".deselect",e.deselect),0===$(this).find("a.deselect").size()&&$(this).hide()}),$(document).on("cbox_load",e.onColorBoxLoaded).on("cbox_cleanup",e.onColorBoxCleanedUp)},n.onColorBoxLoaded=function(){n.anchorAjaxBox||(n.anchorAjaxBox=$.colorbox.element())},n.onColorBoxCleanedUp=function(){n.anchorAjaxBox=null},n.modal=function(e){e||(e={});var o=this,n=e.colorbox||$.colorbox,r=e.$el||$("#ajax-box"),t=window==r[0].ownerDocument.defaultView;return t&&r.find("form.search").on("submit",function(e){var t=$("<span />",{"class":"loading"}).html(SS.loading);return r.find("[type=submit]").after(t),$(this).ajaxSubmit({url:$(this).attr("action"),success:function(e){r.closest("#cboxLoadedContent").html(e)},error:function(){t.html("== Error ==")}}),e.preventDefault(),!1}),r.find(".pagination a").on("click",function(e){return o.selectItems(r),!t||(r.find(".pagination").html(SS.loading),$.ajax({url:$(this).attr("href"),type:"GET",success:function(e){r.closest("#cboxLoadedContent").html(e)},error:function(){r.find(".pagination").html("== Error ==")}}),e.preventDefault(),!1)}),r.find("#s_group").on("change",function(){return o.selectItems(r),r.find("form.search").submit()}),r.find(".submit-on-change").on("change",function(){return o.selectItems(r),r.find("form.search").submit()}),o.anchorAjaxBox.closest("dl").find(".ajax-selected tr[data-id]").each(function(){var e,t,o;return e=$(this).data("id"),(o=$("#colorbox .items [data-id='"+e+"']")).find("input[type=checkbox]").remove(),t=o.find(".select-item,.select-single-item").html(),o.find(".select-item,.select-single-item").replaceWith("<span class='select-item' style='color: #888'>"+t+"</span>")}),r.find("table.index").each(function(){SS_ListUI.render(this)}),r.find("a.select-item").on("click",function(e){if(!SS.disableClick($(this)))return!1;var t=o.anchorAjaxBox;return o.select($(this)),t.closest("dl").find(".ajax-selected").show(),e.preventDefault(),n.close(),!1}),r.find(".select-single-item").on("click",function(e){if(!SS.disableClick($(this)))return!1;var t=o.anchorAjaxBox;return t.closest("dl").find(".ajax-selected tr[data-id]").each(function(){if($(this).find("input[value]").length)return $(this).remove()}),o.select($(this)),t.closest("dl").find(".ajax-selected").show(),e.preventDefault(),n.close(),!1}),r.find(".select-items").on("click",function(e){return SS.disableClick($(this))&&(o.selectItems(r),e.preventDefault(),n.close()),!1}),r.find(".index").on("change",function(){return o.toggleSelectButton(r)}),o.toggleSelectButton(r)},n}(),this.SS_ListUI=function(){function e(){}return e.render=function(e){var a;(a=e?$(e):$(document)).find(".list-head input:checkbox").on("change",function(){var e;return e=$(this).prop("checked"),a.find(".list-item").each(function(){return $(this).toggleClass("checked",e),$(this).find("input:checkbox").prop("checked",e)})}),a.find(".list-item").each(function(){var i;return(i=$(this)).find("input:checkbox").on("change",function(){return i.toggleClass("checked",$(this).prop("checked"))}),i.on("mouseup",function(e){var t,o,n,r;if(!$(e.target).is("a")&&!$(e.target).closest("a,label").length)return(t=i.find(".tap-menu")).is(":visible")?t.hide():(t.hasClass("tap-menu-relative")?(o=$(this).offset(),n=e.pageX-o.left,r=e.pageY-o.top):(n=e.pageX,r=e.pageY),t.css("left",n-t.width()+5).css("top",r).show())}),i.on("mouseleave",function(){return a.find(".tap-menu").hide()})}),a.find(".list-head .destroy-all").each(function(){this.classList.contains("btn-list-head-action")||(this.dataset.ssButtonToAction="",this.dataset.ssButtonToMethod="delete",this.dataset.ssConfirmation="\u524a\u9664\u3057\u3066\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",this.classList.add("btn-list-head-action"))}),a.find(".list-head [data-ss-list-head-method]").each(function(){this.classList.contains("btn-list-head-action")||(this.dataset.ssListHeadAction&&(this.dataset.ssButtonToAction=this.dataset.ssListHeadAction,delete this.dataset.ssListHeadAction),this.dataset.ssListHeadMethod&&(this.dataset.ssButtonToMethod=this.dataset.ssListHeadMethod,delete this.dataset.ssListHeadMethod),this.classList.add("btn-list-head-action"))}),a.find(".list-head .btn-list-head-action").each(function(){$(this).on("ss:beforeSend",function(e){var t=a.find(".list-item input:checkbox:checked").map(function(){return $(this).val()});if(0===t.length)return e.preventDefault(),!1;for(var o=0,n=t.length;o<n;o++){var r=t[o];e.$form.append($("<input/>",{name:"ids[]",value:r,type:"hidden"}))}})})},e}(),this.SS_TreeUI=function(){function c(e,t){null==t&&(t={}),this.tree=$(e);var s=[],l=t.expand_all,o=t.collapse_all,n=t.expand_group;this.tree.find("tbody tr").each(function(){return s.push(parseInt($(this).attr("data-depth")))}),s=Math.min.apply(null,s),s=parseInt(s),isNaN(s)||s<0||(this.tree.find("tbody tr").each(function(){var e,t,o,n,r,i,a;for(a=$(this).find(".expandable"),t=parseInt($(this).attr("data-depth")),a.prepend('<img src="'+c.closeImagePath+'" alt="toggle" class="toggle closed">'),t!==s&&(l||$(this).hide()),o=n=r=s,i=t;r<=i?n<i:i<n;o=r<=i?++n:--n)a.prepend('<span class="padding">');if(e=parseInt($(this).next("tr").attr("data-depth"))||0,o=$(this).find(".toggle:first"),0===e||e<=t)return o.replaceWith('<span class="padding">')}),this.tree.find(".toggle").on("mousedown mouseup",function(e){return e.stopPropagation(),!1}),this.tree.find(".toggle").on("click",function(e){var o,t,n;return t=(n=$(this).closest("tr")).find(".toggle:first"),o=parseInt(n.attr("data-depth")),c.toggleImage(t),n.nextAll("tr").each(function(){var e,t;return e=parseInt($(this).attr("data-depth")),t=$(this).find(".toggle:first"),!(e<=o)&&(o+1===e?$(this).toggle():$(this).hide(),c.closeImage(t))}),e.stopPropagation(),!1}),l?c.openImage(this.tree.find("tbody tr img")):o?c.closeImage(this.tree.find("tbody tr img")):n&&"0"!==$("tbody tr.current").attr("data-depth")?c.openSelectedGroupsTree(this.tree.find("tbody tr.current")):this.tree.find("tr[data-depth='"+s+"'] img").trigger("click"))}return c.openImagePath="/assets/img/tree-open.png",c.closeImagePath="/assets/img/tree-close.png",c.render=function(e,t){return new c(e,t)},c.toggleImage=function(e){return e.attr("src")===c.openImagePath?c.closeImage(e):e.attr("src")===c.closeImagePath?c.openImage(e):void 0},c.openImage=function(e){return e.attr("src",c.openImagePath),e.addClass("opened"),e.removeClass("closed")},c.closeImage=function(e){return e.attr("src",c.closeImagePath),e.removeClass("opened"),e.addClass("closed")},c.openSelectedGroupsTree=function(e){for(i=0;i<parseInt(e.attr("data-depth"));i++){var t=e.prevAll("tr[data-depth="+i.toString()+"]:first"),o=t.find(".toggle:first");t.nextAll("tr").each(function(){var e=parseInt($(this).attr("data-depth"));if(i>=e)return!1;i+1===e&&$(this).show()}),c.openImage(o)}},c.prototype.expandAll=function(){return this.tree.find("tr img.toggle.closed").trigger("click")},c.prototype.collapseAll=function(){return $(this.tree.find("tr img.toggle.opened").get().reverse()).each(function(){return $(this).trigger("click")})},c}(),this.SS_Dropdown=function(){function t(e,t){this.elem=$(e),this.options=t,this.target=$(this.options.target),this.bindEvents()}return t.render=function(){return $("button.dropdown").each(function(){var e;if(e=new t(this,{target:$(this).parent().find(".dropdown-container")[0]}),!t.dropdown)return t.dropdown=e})},t.openDropdown=function(){if(t.dropdown)return t.dropdown.openDropdown()},t.closeDropdown=function(){if(t.dropdown)return t.dropdown.closeDropdown()},t.toggleDropdown=function(){if(t.dropdown)return t.dropdown.toggleDropdown()},t.prototype.bindEvents=function(){var t,o,n;return this.elem.on("click",(t=this,function(e){return t.toggleDropdown(),t.cancelEvent(e)})),$(document).on("click",(o=this,function(e){if(e.target!==o.elem&&e.target!==o.target)return o.closeDropdown()})),this.elem.on("keydown",(n=this,function(e){if(27===e.keyCode)return n.closeDropdown(),n.cancelEvent(e)}))},t.prototype.openDropdown=function(){return this.target.show()},t.prototype.closeDropdown=function(){return this.target.hide()},t.prototype.toggleDropdown=function(){return this.target.toggle()},t.prototype.cancelEvent=function(e){return e.preventDefault(),e.stopPropagation(),!1},t}(),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return t<this.length?t|=0:t=this.length,this.substr(t-e.length,e.length)===e}),String.prototype.includes||(String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),String.prototype.padEnd||(String.prototype.padEnd=function(e,t){return e>>=0,t=String(t||" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),String(this)+t.slice(0,e))}),String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(t||" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))}),String.prototype.repeat||(String.prototype.repeat=function(e){if(null==this)throw new TypeError("can't convert "+this+" to object");var t=""+this;if((e=+e)!=e&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e==1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0==t.length||0==e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var o="";1==(1&e)&&(o+=t),0!=(e>>>=1);)t+=t;return o}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),SS_Preview=function(){function s(e){this.el=e,this.inplaceMode=!1,this.layouts=[],this.parts=[],this.editLock=new t(this),this.updateDisabled=!1}function t(e){this.container=e,this.timerId=null}function o(e){this.container=e,this.$overlay=$("#ss-preview-overlay"),this.initPosition();var o=this;this.$overlay.on("click",".ss-preview-overlay-btn-edit",function(){var e=o.$overlay.data("mode")+":edit";o.$overlay.trigger(e,o.$overlay.data())}),this.$overlay.on("click",".ss-preview-overlay-btn-delete",function(){var e=o.$overlay.data("mode")+":delete";o.$overlay.trigger(e,o.$overlay.data())}),this.$overlay.on("click",".ss-preview-overlay-btn-move-up",function(){var e=o.$overlay.data("mode")+":moveUp";o.$overlay.trigger(e,o.$overlay.data())}),this.$overlay.on("click",".ss-preview-overlay-btn-move-down",function(){var e=o.$overlay.data("mode")+":moveDown";o.$overlay.trigger(e,o.$overlay.data())}),this.$overlay.on("change",".ss-preview-overlay-btn-move-position",function(){var e=o.$overlay.data("mode")+":movePosition",t=parseInt($(this).val(),10);o.$overlay.trigger(e,[o.$overlay.data(),t])}),this.on=this.$overlay.on.bind(this.$overlay),this.off=this.$overlay.off.bind(this.$overlay)}function r(e,t){this.container=e,this.$el=t;var o=this;this.$el.on("load",function(){o.initializeFrame()})}function a(e){this.container=e,this.$el=this.container.$el.find(".ss-preview-notice-wrap"),this.timerId=null}return s.libs={jquery:{isInstalled:function(){return!!window.jQuery},js:null,css:null},datetimePicker:{isInstalled:function(){return!!$.datetimepicker},js:null,css:null},colorbox:{isInstalled:function(){return!!$.colorbox},js:null,css:null},dialog:{isInstalled:function(){return $.ui&&$.ui.dialog},js:null,css:null}},s.confirms={"delete":null,publish:null},s.notices={deleted:null,published:null,moved:null},s.item={},s.preview_path="",s.mobile_path="/mobile",s.request_path=null,s.form_item=null,s.overlayPadding=0,s.previewToolHeight=70,s.inplaceFormPath={page:null,columnValue:{},palette:null},s.workflowPath={wizard:null,pages:null,request:null},s.redirectorPath={newPage:null},s.publishPath=null,s.lockPath=null,s.refreshLockInterval=12e4,s.instance=null,s.minFrameSize={width:320,height:150},s.initialFrameSize={width:960,height:240},s.initialApproverSize={width:s.initialFrameSize.width,height:480},s.jqueryDialogMargin={height:60},s.pageTitle="\u672c\u6587",s.userInplaceEdit=!0,s.render=function(e){s.instance||(s.instance=new s("#ss-preview"),s.loadJQuery(function(){$.when(s.lazyLoad(s.libs.datetimePicker),s.lazyLoad(s.libs.colorbox),s.lazyLoad(s.libs.dialog)).done(function(){s.instance.initialize(e)})}))},s.loadJQuery=function(e){if(window.jQuery)e();else{var t=document.createElement("link");t.rel="stylesheet",t.href=s.libs.jquery.css;var o=document.createElement("script");o.type="text/javascript",o.src=s.libs.jquery.js,o.readyState||(o.onload=function(){e()}),document.getElementsByTagName("head")[0].appendChild(t),document.getElementsByTagName("head")[0].appendChild(o)}},s.lazyLoad=function(e){var t,o,n=$.Deferred();return e.isInstalled()?n.resolve():(e.css&&((t=document.createElement("link")).rel="stylesheet",t.href=e.css),e.js&&((o=document.createElement("script")).type="text/javascript",o.src=e.js),t&&document.getElementsByTagName("head")[0].appendChild(t),o?(o.readyState?n.resolve():o.onload=function(){n.resolve()},document.getElementsByTagName("head")[0].appendChild(o)):n.resolve()),n.promise()},s.notice=function(e){s.instance&&s.instance.notice&&s.instance.notice.show(e)},s.bindToWorkflowCommentForm=function(e){s.instance&&s.instance.bindToWorkflowCommentForm(e)},s.openNewWindow=function(e){var t=document.createElement("a");t.href=e,t.target="_blank",t.rel="noopener",t.click()},s.prototype.initialize=function(e){this.$el=$(this.el),this.$datePicker=this.$el.find(".ss-preview-date"),this.$datePicker.datetimepicker({lang:"ja",roundTime:"ceil",step:30,closeOnDateSelect:!0});var n=this;this.initializePart(),this.initializeLayout(),this.initializePage(),this.initializeColumn(),this.$el.on("click","#ss-preview-btn-workflow-start",function(){n.openWorkflowApprove()}),this.$el.on("click","#ss-preview-btn-workflow-approve",function(){n.openWorkflowComment("approve")}),this.$el.on("click","#ss-preview-btn-workflow-remand",function(){n.openWorkflowComment("remand")}),this.$el.on("click","#ss-preview-btn-workflow-pull-up",function(){n.openWorkflowComment("pull-up")}),this.$el.on("click","#ss-preview-btn-publish",function(){n.publish()}),this.overlay=new o(this),this.overlay.on("part:edit",function(e,t){n.openPartEdit(t.id)}),this.overlay.on("page:edit",function(e,t){n.openPageEdit(t.id)}),this.overlay.on("column:edit",function(e,t){n.openColumnEdit(t.id)}),this.overlay.on("column:delete",function(e,t){n.postColumnDelete(t.id)}),this.overlay.on("column:moveUp",function(e,t){n.postColumnMoveUp(t.id)}),this.overlay.on("column:moveDown",function(e,t){n.postColumnMoveDown(t.id)}),this.overlay.on("column:movePosition",function(e,t,o){n.postColumnMovePosition(t.id,o)});var t=$("#ss-preview-form-end");t[0]&&(this.formPalette=r.createBefore(this,t[0])),this.$el.on("click",".ss-preview-btn-toggle-inplace",function(){var e=n.inplaceMode;n.toggleInplaceMode().always(function(){e!==n.inplaceMode&&window.history.pushState&&(n.inplaceMode?window.history.pushState(null,null,window.location.pathname+"#inplace"):window.history.pushState(null,null,window.location.pathname))})}),this.$el.on("click","#ss-preview-btn-workflow-start",function(){var e=n.inplaceMode;n.inplaceMode&&n.toggleInplaceMode().always(function(){e!==n.inplaceMode&&window.history.pushState&&window.history.pushState(null,null,window.location.pathname)})}),$(document).on("click",".ss-preview-btn-open-path",function(){var e=$(this).data("path");e&&s.openNewWindow(e)});var i=this.$el.find("#ss-preview-btn-select-node");i.colorbox({iframe:!0,fixed:!0,width:"90%",height:"90%"}).data("on-select",function(e){var t=e.closest("[data-id]"),o=t.data("id"),n=t.find(".name").text(),r=i.closest("[data-node-id]");s.setData(r,"node-id",o),r.find("label").html(n)}),this.$el.find("#ss-preview-btn-create-new-page").on("click",function(){var e=i.closest("[data-node-id]").data("node-id");window.open(s.redirectorPath.newPage.replace(":nodeId",e))}),this.$el.find("#ss-preview-btn-select-draft-page").colorbox({iframe:!0,fixed:!0,width:"90%",height:"90%"}).data("on-select",function(e){var t=e.closest("[data-id]").find(".filename").text(),o=s.previewPath.replace(":path",t);"#inplace"===window.location.hash&&(o+="#inplace"),window.location.href=o}),this.$el.on("click",".ss-preview-btn-pc",function(){n.previewPc()}),this.$el.on("click",".ss-preview-btn-mobile",function(){n.previewMobile()}),s.request_path&&$('body a [href="#"]').val("onclick","return false;"),window.history.pushState&&window.addEventListener("popstate",function(){"#inplace"===window.location.hash?n.startInplaceMode():n.stopInplaceMode()}),"#inplace"===window.location.hash&&this.startInplaceMode(),this.notice=new a(this),e.notice&&this.notice.show(e.notice)},s.prototype.initializeLayout=function(){var e=$("body");e.data("layout-id")&&(this.layouts=[{id:e.data("layout-id"),name:e.data("layout-name"),filename:e.data("layout-filename"),path:e.data("layout-path")}]);var t=this.$el.find(".ss-preview-btn-edit-layout");if(this.layouts&&0!==this.layouts.length){t.closest(".ss-preview-btn-group").removeClass("ss-preview-hide");var o=this.layouts[0].path;t.on("click",function(){s.openNewWindow(o)})}else t.closest(".ss-preview-btn-group").addClass("ss-preview-hide")},s.prototype.initializePage=function(){var e=this;$(document).on("mouseover",".ss-preview-page",function(){e.inplaceMode&&e.overlay.showForPage($(this))})},s.prototype.adjustDialogSize=function(e){var t=e.contentWindow.document.body.scrollWidth,o=e.contentWindow.document.body.scrollHeight;$(e).closest(".ui-dialog")[0]&&(o+=s.jqueryDialogMargin.height),t<s.initialFrameSize.width&&(t=s.initialFrameSize.width),o<s.initialFrameSize.height&&(o=s.initialFrameSize.height);var n=Math.floor(.9*window.innerWidth),r=Math.floor(.9*window.innerHeight);n<t&&(t=n),r<o&&(o=r),$(e).closest("#cboxLoadedContent")[0]&&$.colorbox.resize({width:t,height:o}),$(e).closest(".ui-dialog")[0]&&$(e).dialog("option","width",t).dialog("option","height",o).css("display","").css("width","")},s.prototype.initializeFrame=function(r){var i=r.contentWindow.document.querySelector("#item-form");if(i){this.adjustDialogSize(r);var a=this;a.saveIfNoAlerts=!1,a.ignoreAlertsAndSave=!1,i.addEventListener("click",function(e){var t=e.target;return"BUTTON"===t.tagName&&t.classList.contains("btn-cancel")&&($(r).closest("#cboxLoadedContent")[0]&&$.colorbox.close(),$(r).closest(".ui-dialog")[0]&&$(r).dialog("close")),"INPUT"===t.tagName&&"save_if_no_alerts"===t.name&&(a.saveIfNoAlerts=!0),"INPUT"===t.tagName&&"ignore_alerts_and_save"===t.name&&(a.ignoreAlertsAndSave=!0),!0}),i.onsubmit=function(e){var t=r.contentWindow.Cms_Form.getFormData(r.contentWindow.$(i),{preserveMethod:!0});a.saveIfNoAlerts&&t.append("save_if_no_alerts","button"),a.ignoreAlertsAndSave&&t.append("ignore_alerts_and_save","button");var o=i.getAttribute("action"),n=i.getAttribute("method")||"POST";return $.ajax({url:o,type:n,data:t,processData:!1,contentType:!1,cache:!1,success:function(e){$.colorbox.close(),"string"==typeof e?location.reload():e&&e.location?location.href=e.location:location.reload()},error:function(e){var t=$(e.responseText).find("#item-form");i.innerHTML=t.html(),a.adjustDialogSize(r)}}),a.saveIfNoAlerts=!1,a.ignoreAlertsAndSave=!1,e.preventDefault(),!1},r.contentWindow.CKEDITOR&&r.contentWindow.CKEDITOR.on("instanceReady",function(e){a.adjustRichEditorHeight(e.editor)})}},s.prototype.openDialogInFrame=function(e){var t=this,o=$("<iframe></iframe>",{id:"ss-preview-dialog-frame",frameborder:"0",allowfullscreen:!0,src:e});o[0].onload=function(){t.initializeFrame(o[0])},o.dialog({autoOpen:!0,width:s.initialFrameSize.width,height:s.initialFrameSize.height,minWidth:s.minFrameSize.width,minHeight:s.minFrameSize.height,closeOnEscape:!1,dialogClass:"ss-preview-dialog ss-preview-dialog-column",draggable:!0,modal:!0,resizable:!0,close:function(){$(this).dialog("destroy").remove()}})},s.prototype.openDialog=function(e,o){var i=this;o||(o={}),$.ajax({url:e,type:"GET",success:function(e){var t=$("div#ss-preview-dialog-frame");t[0]||(t=$("<div></div>",{id:"ss-preview-dialog-frame"})),t.html(e),t.dialog({autoOpen:!0,width:o.width||s.initialFrameSize.width,height:o.height||s.initialFrameSize.height,minWidth:o.minWidth||s.minFrameSize.width,minHeight:o.minHeight||s.minFrameSize.height,closeOnEscape:!1,dialogClass:"ss-preview-dialog ss-preview-dialog-column",draggable:!0,modal:!0,resizable:!0,close:function(){$(this).dialog("destroy").remove()}})},error:function(e,t,o){try{var n=e.responseJSON.join("\n");i.notice.show(n)}catch(r){i.notice.show("Error: "+o)}}})},s.prototype.adjustRichEditorHeight=function(e){if("ready"===e.status){var t=$(e.element.$).parent().height();(t-=40)<50&&(t=50),e.resize("100%",t.toString())}},s.prototype.openPageEdit=function(e){var t=s.inplaceFormPath.page.replace(":id",e);this.openDialogInFrame(t)},s.prototype.initializePart=function(){var t=this;if(this.parts=[],$(document).find(".ss-preview-part").each(function(){var e=$(this);e.data("part-id")&&t.parts.push({el:e,id:e.data("part-id"),name:e.data("part-name"),filename:e.data("part-filename"),path:e.data("part-path")})}),this.parts&&0!==this.parts.length){var e=this.$el.find(".ss-preview-part-list"),o=e.html();$.each(this.parts,function(e,t){o+='<option value="'+t.id+'">'+t.name+"</option>"}),e.html(o).on("change",function(){t.changePart($(this))}),this.$el.on("click",".ss-preview-btn-edit-part",function(){t.openPartEdit(e.val())}),this.$el.find(".ss-preview-part-group").removeClass("ss-preview-hide"),$(document).on("mouseover",".ss-preview-part",function(){t.inplaceMode&&t.overlay.showForPart($(this))})}else this.$el.find(".ss-preview-part-group").addClass("ss-preview-hide")},s.prototype.findPartById=function(t){if(!t)return null;"string"===$.type(t)&&(t=parseInt(t));var e=$.grep(this.parts,function(e){return e.id===t});return e&&0!==e.length?e[0]:null},s.prototype.initializeColumn=function(){var e=this;$(document).on("mouseover",".ss-preview-column",function(){e.inplaceMode&&e.overlay.showForColumn($(this))})},s.prototype.openColumnEdit=function(e){var t=s.inplaceFormPath.columnValue.edit.replace(":pageId",e.pageId).replace(":id",e.columnId);this.openDialogInFrame(t)},s.prototype.postColumnDelete=function(o){if(confirm(s.confirms["delete"])){var i=this,e=s.inplaceFormPath.columnValue.destroy.replace(":pageId",o.pageId).replace(":id",o.columnId),t=$('meta[name="csrf-token"]').attr("content");$.ajax({url:e,type:"POST",data:{_method:"DELETE",authenticity_token:t},success:function(e){if(i.overlay.hide(),e&&e.location)location.href=e.location;else{var t=$(document).find(".ss-preview-column[data-page-id='"+o.pageId+"'][data-column-id='"+o.columnId+"']");t.fadeOut("fast",function(){t.remove(),i.notice.show(s.notices.deleted)})}},error:function(e,t,o){try{var n=e.responseJSON.join("\n");i.notice.show(n)}catch(r){i.notice.show("Error: "+o)}}})}},s.prototype.postColumnMoveUp=function(t){var i=this,e=s.inplaceFormPath.columnValue.moveUp.replace(":pageId",t.pageId).replace(":id",t.columnId),o=$('meta[name="csrf-token"]').attr("content");$.ajax({url:e,type:"POST",data:{authenticity_token:o},success:function(e){i.overlay.hide(),e.location?location.href=e.location:(i.finishColumnMoveUp(t,e),i.notice.show(s.notices.moved))},error:function(e,t,o){try{var n=e.responseJSON.join("\n");i.notice.show(n)}catch(r){i.notice.show("Error: "+o)}}})},s.camelize=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/[\s-]+/g,"")},s.setData=function(e,t,o){e.data(t,o);var n=s.camelize(t);e.each(function(){this.dataset[n]=o})},s.prototype.finishColumnMoveUp=function(e,t){this.overlay.hide();var o=$(document).find(".ss-preview-column[data-page-id='"+e.pageId+"'][data-column-id='"+e.columnId+"']");if(o[0]){var n=o.prev(".ss-preview-column[data-page-id='"+e.pageId+"']");n[0]&&Cms_TemplateForm.swapElement(n,o,function(){s.setData(n,"column-order",t[n.data("column-id")]),s.setData(o,"column-order",t[o.data("column-id")]),o.after(n)})}},s.prototype.postColumnMoveDown=function(t){var i=this,e=s.inplaceFormPath.columnValue.moveDown.replace(":pageId",t.pageId).replace(":id",t.columnId),o=$('meta[name="csrf-token"]').attr("content");$.ajax({url:e,type:"POST",data:{authenticity_token:o},success:function(e){i.overlay.hide(),e.location?location.href=e.location:(i.finishColumnMoveDown(t,e),i.notice.show(s.notices.moved))},error:function(e,t,o){try{var n=e.responseJSON.join("\n");i.notice.show(n)}catch(r){i.notice.show("Error: "+o)}}})},s.prototype.finishColumnMoveDown=function(e,t){this.overlay.hide();var o=$(document).find(".ss-preview-column[data-page-id='"+e.pageId+"'][data-column-id='"+e.columnId+"']");if(o[0]){var n=o.next(".ss-preview-column[data-page-id='"+e.pageId+"']");n[0]&&Cms_TemplateForm.swapElement(o,n,function(){s.setData(n,"column-order",t[n.data("column-id")]),s.setData(o,"column-order",t[o.data("column-id")]),o.before(n)})}},s.prototype.postColumnMovePosition=function(t,o){var i=this,e=s.inplaceFormPath.columnValue.moveAt.replace(":pageId",t.pageId).replace(":id",t.columnId),n=$('meta[name="csrf-token"]').attr("content");$.ajax({url:e,type:"POST",data:{authenticity_token:n,order:o},success:function(e){e.location?location.href=e.location:(i.finishColumnMovePosition(t,o,e),i.notice.show(s.notices.moved))},error:function(e,t,o){try{var n=e.responseJSON.join("\n");i.notice.show(n)}catch(r){i.notice.show("Error: "+o)}}})},s.prototype.finishColumnMovePosition=function(e,t,o){this.overlay.hide();var n=$(document).find(".ss-preview-column[data-page-id='"+e.pageId+"'][data-column-id='"+e.columnId+"']");if(n[0]){var r=n.data("column-order"),i=$(document).find(".ss-preview-column[data-page-id='"+e.pageId+"'][data-column-order='"+t+"']");i[0]&&Cms_TemplateForm.insertElement(n,i,function(){$(document).find(".ss-preview-column[data-page-id='"+e.pageId+"']").each(function(){var e=$(this);s.setData(e,"column-order",o[e.data("column-id")])}),t<r?i.before(n):i.after(n)})}},s.prototype.previewPc=function(){var e=this.dateForPreview();if(e){var t=s.request_path||location.pathname;t=t.replace(RegExp("\\/preview\\d*("+s.mobile_path+"|"+s.preview_path+")?"),"/preview"+e+s.preview_path)+location.search,s.request_path?this.submitFormPreview(t,s.form_item):location.href=t}},s.prototype.previewMobile=function(){var e=this.dateForPreview();if(e){var t=s.request_path||location.pathname;t=t.replace(RegExp("\\/preview\\d*("+s.mobile_path+"|"+s.preview_path+")?"),"/preview"+e+s.mobile_path)+location.search,s.request_path?this.submitFormPreview(t,s.form_item):location.href=t}},s.prototype.dateForPreview=function(){var e=this.$datePicker.val();if(e)return e.replace(/[^\d]/g,"")},s.prototype.submitFormPreview=function(e,t){var o=$('meta[name="csrf-token"]').attr("content"),n=$("<form>").attr("method","post").attr("action",e);s.appendParams(n,"preview_item",t),n.append($("<input/>",{name:"authenticity_token",value:o,type:"hidden"})),n.appendTo("body"),n.submit()},s.prototype.changePart=function(e){var t=this.findPartById(e.val());t?(this.overlay.showForPart(t.el),this.scrollToPart(t.el)):this.overlay.hide()},s.prototype.scrollToPart=function(e){var t=e.offset().top-s.previewToolHeight;t<0&&(t=0),window.scrollTo({top:t,behavior:"smooth"})},s.prototype.openPartEdit=function(e){var t=this.findPartById(e);t&&s.openNewWindow(t.path)},s.prototype.openWorkflowApprove=function(){var e=s.workflowPath.wizard.replace(":id",s.item.pageId)+"/frame";this.openDialog(e,{width:s.initialApproverSize.width,height:s.initialApproverSize.height})},s.prototype.openWorkflowComment=function(e){var t=s.workflowPath.wizard.replace(":id",s.item.pageId)+"/comment?update_type="+e;this.openDialog(t,{width:s.initialApproverSize.width,height:s.initialApproverSize.height})},s.prototype.bindToWorkflowCommentForm=function(r){var i=this,a=$("#ss-preview-dialog-frame");a.on("click","input[type=submit]",function(){var e=a.find("textarea[name=comment]").prop("value"),t=r+"_update",o=s.workflowPath.pages.replace(":id",s.item.pageId);o+="/"+t;var n=s.request_path||location.pathname;i.updateDisabled||(i.updateDisabled=!0,$.ajax({type:"POST",url:o,data:{remand_comment:e,url:n,forced_update_option:!0},success:function(e){if(e.workflow_alert)return i.updateDisabled=!1,void i.notice.show(e.workflow_alert);e.redirect.reload?location.reload():e.redirect.url?location.href=s.previewPath.replace(":path",e.redirect.url.slice(1)):location.reload()},error:function(e,t,o){try{var n=e.responseJSON.join("\n");i.notice.show(n)}catch(r){i.notice.show("Error: "+o)}i.updateDisabled=!1},complete:function(){a.dialog("close")}}))}),a.on("click","button[type=reset]",function(){a.dialog("close")})},s.prototype.publish=function(){if(confirm(s.confirms.publish)){var i=this,e=s.publishPath,t=$('meta[name="csrf-token"]').attr("content");i.updateDisabled||(i.updateDisabled=!0,$.ajax({url:e,type:"POST",data:{authenticity_token:t},success:function(e){(i.overlay.hide(),e&&e.location)?location.href=e.location:(i.notice.show(s.notices.published),i.$el.find("#ss-preview-btn-publish"
).closest(".ss-preview-btn-group").remove(),i.updateDisabled=!1)},error:function(e,t,o){try{var n=e.responseJSON.join("\n");i.notice.show(n)}catch(r){i.notice.show("Error: "+o)}i.updateDisabled=!1}}))}},t.prototype.acquire=function(){if(!s.lockPath)return $.Deferred().resolve().promise();var n=this,e=s.lockPath,t=$('meta[name="csrf-token"]').attr("content");return $.ajax({url:e,type:"POST",dataType:"json",cache:!1,data:{authenticity_token:t}}).done(function(){n.bindBeforeUnloadOnce()}).fail(function(e,t,o){n.container.notice&&(e.responseJSON?n.container.notice.show(e.responseJSON.join("\n")):n.container.notice.show(o))})},t.prototype.release=function(){if(!s.lockPath)return $.Deferred().resolve().promise();var n=this,e=s.lockPath,t=$('meta[name="csrf-token"]').attr("content");return $.ajax({url:e,type:"POST",dataType:"json",cache:!1,data:{_method:"delete",authenticity_token:t}}).fail(function(e,t,o){n.container.notice&&(e.responseJSON?n.container.notice.show(e.responseJSON.join("\n")):n.container.notice.show(o))})},t.prototype.startRefreshLoop=function(e){var t=this;t.timerId||(t.timerId=setTimeout(function(){t.acquire().fail(e),t.startRefreshLoop()},s.refreshLockInterval))},t.prototype.stopRefreshLoop=function(){this.timerId&&clearTimeout(this.timerId),this.timerId=null},t.prototype.bindBeforeUnloadOnce=function(){var e=this;$(window).on("beforeunload",function(){e.release()}),this.bindBeforeUnloadOnce=function(){}},s.prototype.toggleInplaceMode=function(){return this.inplaceMode?this.stopInplaceMode():this.startInplaceMode()},s.prototype.startInplaceMode=function(){if(!s.userInplaceEdit)return $.Deferred().resolve().promise();if(!this.inplaceMode){var e=this;return this.editLock.acquire().done(function(){e.inplaceMode=!0,e.$el.find(".ss-preview-btn-toggle-inplace").addClass("ss-preview-active"),$("#ss-preview-notice").addClass("ss-preview-hide"),e.formPalette&&e.formPalette.show(),$("a[href]").each(function(){var e=$(this),t=e.attr("href");t&&t.startsWith("/")&&(t.includes("#")||e.attr("href",t+"#inplace"))}),e.editLock.startRefreshLoop(function(){e.stopInplaceMode(!0)}),window.location.hash="#inplace"})}},s.prototype.stopInplaceMode=function(e){if(this.inplaceMode){var t=this,o=function(){t.editLock.stopRefreshLoop(),t.$el.find(".ss-preview-btn-toggle-inplace").removeClass("ss-preview-active"),t.overlay.hide(),t.formPalette&&t.formPalette.hide(),$("a[href]").each(function(){var e=$(this),t=e.attr("href");t&&t.startsWith("/")&&e.attr("href",t.replace("#inplace",""))}),t.inplaceMode=!1,window.location.hash=""};return e?(o(),$.Deferred().resolve().promise()):this.editLock.release().always(o)}},s.prototype.showError=function(e){var t=[];$.each(e,function(){t.push("<li>"+this+"</li>")}),$("#ss-preview-error-explanation ul").html(t.join()),$("#ss-preview-error-explanation").removeClass("ss-preview-hide"),$("#ss-preview-messages").removeClass("ss-preview-hide")},s.prototype.clearError=function(){$("#ss-preview-error-explanation ul").html(""),$("#ss-preview-error-explanation").addClass("ss-preview-hide"),$("#ss-preview-messages").addClass("ss-preview-hide")},s.appendParams=function(e,t,o){var n,r,i;for(n in o.length<=0&&e.append($("<input/>",{name:t+"[]",value:"",type:"hidden"})),r=[],o)i=o[n],n.match(/^\d+$/)&&(n=""),"object"==typeof i?r.push(s.appendParams(e,t+"["+n+"]",i)):r.push(e.append($("<input/>",{name:t+"["+n+"]",value:i,type:"hidden"})));return r},o.prototype.initPosition=function(){var e=this.$overlay.find(".ss-preview-overlay-btn-move-position");if(e[0]){var t=[];$(document).find(".ss-preview-column[data-column-order]").each(function(){var e=parseInt(this.dataset.columnOrder,10);t.push('<option value="'+e+'">'+(e+1)+"</option>")}),e.html(t.join(""))}},o.prototype.hide=function(){this.$overlay.addClass("ss-preview-hide")},o.prototype.showForPage=function(e){var t=e[0].getBoundingClientRect();t&&(this.moveTo(t),this.setInfo({mode:"page",id:e.data("page-id"),name:s.pageTitle}),this.$overlay.find(".ss-preview-overlay-btn-group-move").addClass("ss-preview-hide"),this.$overlay.find(".ss-preview-overlay-btn-group-delete").addClass("ss-preview-hide"),this.$overlay.removeClass("ss-preview-hide"))},o.prototype.showForColumn=function(e){var t=e[0].getBoundingClientRect();if(t){if(this.moveTo(t),this.setInfo({mode:"column",id:{pageId:e.data("page-id"),columnId:e.data("column-id")},name:e.data("column-name")}),"entry"===s.item.formSubType)this.$overlay.find(".ss-preview-overlay-btn-group-move").removeClass("ss-preview-hide"),this.$overlay.find(".ss-preview-overlay-btn-group-delete").removeClass("ss-preview-hide"),this.$overlay.find(".ss-preview-overlay-btn-move-position").val(e.data("column-order"));else this.$overlay.find(".ss-preview-overlay-btn-group-move").addClass("ss-preview-hide"),this.$overlay.find(".ss-preview-overlay-btn-group-delete").addClass("ss-preview-hide");this.$overlay.removeClass("ss-preview-hide")}},o.prototype.showForPart=function(e){var t=this.container.findPartById(e.data("part-id"));if(t){var o=e[0].getBoundingClientRect();o&&(this.moveTo(o),this.setInfo({mode:"part",id:t.id,name:t.name}),this.$overlay.find(".ss-preview-overlay-btn-group-move").addClass("ss-preview-hide"),this.$overlay.find(".ss-preview-overlay-btn-group-delete").addClass("ss-preview-hide"),this.$overlay.removeClass("ss-preview-hide"))}},o.prototype.moveTo=function(e){var t=window.pageYOffset||document.documentElement.scrollTop,o=window.pageXOffset||document.documentElement.scrollLeft,n=Math.floor(e.top+t)-s.overlayPadding,r=Math.floor(e.left+o)-s.overlayPadding,i=e.width+2*s.overlayPadding,a=e.height+2*s.overlayPadding;this.$overlay[0].style.top=n+"px",this.$overlay[0].style.left=r+"px",this.$overlay[0].style.width=i+"px",this.$overlay[0].style.height=a+"px"},o.prototype.setInfo=function(e){s.setData(this.$overlay,"mode",e.mode),s.setData(this.$overlay,"id",e.id),e.name?this.$overlay.find(".ss-preview-overlay-name").text(e.name).removeClass("ss-preview-hide"):this.$overlay.find(".ss-preview-overlay-name").text("").addClass("ss-preview-hide")},r.margin={height:20},r.createBefore=function(e,t){var o=t.dataset.formId;if(!o)return null;if("entry"!==t.dataset.formSubType)return null;var n=$("<iframe />",{id:"ss-preview-form-palette","class":"ss-preview-hide",frameborder:"0",scrolling:"no",src:s.inplaceFormPath.palette.replace(":id",o)});return $(t).before(n),new r(e,n)},r.prototype.initializeFrame=function(){this.adjustHeight();var e=this.$el[0],n=this;e.contentWindow.addEventListener("resize",function(){n.delayAdjustHeight()}),e.contentWindow.document.addEventListener("click",function(e){var t=e.target;if("BUTTON"===t.tagName&&t.dataset.formId&&t.dataset.columnId)n.clickPalette(t);else{var o=$(t).closest("button[data-form-id]")[0];o&&o.dataset.formId&&o.dataset.columnId&&n.clickPalette(o)}})},r.prototype.delayAdjustHeight=function(){0<this.timer&&clearTimeout(this.timer);var e=this;this.timer=setTimeout(function(){e.adjustHeight(),e.timer=0},100)},r.prototype.adjustHeight=function(){var e=this.$el[0];if(e){var t=e.contentWindow.document.body.scrollHeight+r.margin;e.style.height=t+"px"}},r.prototype.show=function(){this.$el.removeClass("ss-preview-hide"),this.delayAdjustHeight()},r.prototype.hide=function(){this.$el.addClass("ss-preview-hide")},r.prototype.clickPalette=function(e){var t=e.dataset.formId,o=e.dataset.columnId;if(t&&o){var n=s.inplaceFormPath.columnValue["new"].replace(":pageId",s.item.pageId).replace(":columnId",o);this.container.openDialogInFrame(n)}},a.speed="normal",a.holdInMillis=1800,a.prototype.show=function(e){this.hide();var t=this;this.$el.html(e).slideDown(a.speed,function(){t.noticeShown()})},a.prototype.hide=function(){this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.$el.hide(),this.$el.html("")},a.prototype.noticeShown=function(){var e=this;this.timerId=setTimeout(function(){e.$el.slideUp(a.speed),e.timerId=null},a.holdInMillis)},s}();